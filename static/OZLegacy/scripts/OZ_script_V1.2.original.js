function userdata(){fulltree=new midnode(rawData)}function cutNewickToThreePart(a){var c;var b=0;for(c=0;c<a.length;c++){if(a.charAt(c)=="("){b++}if(a.charAt(c)==")"){b--}if(a.charAt(c)==","){if(b==1){cut=c}}if(b==0){end=c;c=a.length+1}}var d=new Array();d[0]=a.substr(1,cut-1);d[1]=a.substr(cut+1,end-cut-1);d[2]=a.substr(end+1,a.length-end);return d}midnode.prototype.parseLeafNode=function(a){this.child1=null;this.child2=null;this.richness_val=0;var b=-1;a=this.parseAge(a);a=this.parseCode(a);if(a.length>0){b=a.indexOf("_");if(b==-1){this.name2=null;this.name1=a}else{this.name1=a.substr(b+1,(a.length)-b-1);this.name2=a.substr(0,b)}}else{this.name2=null;this.name1=null}};midnode.prototype.parseCircleNode=function(a){a=this.parseAge(a);a=this.parseCode(a);if(a.length>0){this.setNames(a)}else{this.name2=null;this.name1=null}this.richness_val=0};midnode.prototype.parseAge=function(c){var b;var a=c.indexOf(":");if(a==-1){this.lengthbr=null}else{this.lengthbr=parseFloat(c.substr(a+1,(c.length)-a-1));c=c.substr(0,a)}return c};midnode.prototype.parseCode=function(b){var a=b.indexOf("[");if(a==-1){this.metacode=null}else{this.metacode=parseFloat(b.substr(a+1,(b.length)-a-2));b=b.substr(0,a)}return b};midnode.prototype.setNames=function(a){this.name1=a;this.name2=null};function midnode(L){var K;var J;var u;var q;var z;var v;var ab;var Z;var E;var c;var b;var e;var w;var N;var n;var h;var H;var a;var G;var C;var V;var y;var P;var I;var j;var r;var X;var o;var U;var m;var l;var M;var g;var p;var F;var O;var Q;var s=0;var ac=0;var d=0;var W=false;var aa=false;var R=0;var T=false;var S=false;var D=true;var k=false;this.linkclick=false;this.phylogenetic_diversity=0;var Y=0;var f;var A;if(L.charAt(L.length-1)==";"){L=L.substr(0,L.length-1)}if(L.charAt(0)=="("){var B=cutNewickToThreePart(L);this.parseCircleNode(B[2]);this.child1=new midnode(B[0],this);this.child2=new midnode(B[1],this)}else{this.parseLeafNode(L)}}var animation_status=-1;var previous_filename;var previous_draftonly;var searchinteriornodes=false;var auto_interior_node_labels=true;var popuptext=null;var popuptext2=null;var justopened;var zoominnum;var zoomoutnum;var shapechanged=false;var loadingcontent=false;var widthres=1000;var heightres=600;var xmin=0;var xmax=widthres;var ymin=0;var ymax=heightres;var widthofcontrols=800;var widthofcontrols2=560;var widthofinfobar=620;var buttonoptions=0;var context;var myCanvas;var fulltree;var ws=1;var xp=widthres/2;var yp=heightres;var wsinit;var calculating=false;var latest_ws;var mousehold=false;var buttonhold=false;var mouseX;var mouseY;var oldyp;var oldxp;var timelim=-1;var timeinc;var t2;var growing=false;var growingpause=false;var flying=false;var countdownB=0;var t;var numhits;var searchinparts=[];var searchinfull=null;var fullsearch=null;var highlight_search=false;var latin_search=false;var common_search=true;var trait_search=true;var infotype=0;var mouse_on_url=null;var mouse_on_url_new=true;var mouse_on_url_valid=false;var about_to_open_url;var about_to_open_url_new;var justopened_url=false;var introlock=false;var mywindow;var debugtext=null;function init(){loadingcontent=true;set_defaults();init_logos();shapechanged=false;zoominnum=7;zoomoutnum=7;myCanvas=document.getElementById("myCanvas");if(($(myCanvas).attr("data_status")=="embedded"||$("#myCanvas").attr("data_status")=="embedded_front")&&animation_status!=1&&animation_status!=-2&&animation_status!=-3){animation_status=0}else{if(animation_status!=-2&&animation_status!=-3){animation_status=1}}clearbuttons();buttonoptions=0;document.getElementById("JSnotsupported").style.display="none";context=myCanvas.getContext("2d");if(!(context)){document.getElementById("Canvasnotsupported").style.display=""}else{document.getElementById("Canvasnotsupported").style.display="none"}Resize_only();draw_loading();setTimeout("init2()",10)}function init2(){if(typeof previous_filename=="undefined"||previous_filename!=file_name||typeof previous_draftonly=="undefined"||previous_draftonly!=draft_only){previous_filename=file_name;previous_draftonly=draft_only;var a=document.getElementById("_min");if(a){a.parentNode.removeChild(a)}a=document.getElementById("_tree");if(a){a.parentNode.removeChild(a)}a=document.getElementById("_meta");if(a){a.parentNode.removeChild(a)}if(draft_only){var b=document.createElement("script");b.setAttribute("id","_min");b.src="user/"+file_name+"_min.js";b.onload=function(){init3()};document.head.appendChild(b)}else{var b=document.createElement("script");b.setAttribute("id","_tree");b.src="user/"+file_name+"_tree.js";b.onload=function(){var c=document.createElement("script");c.setAttribute("id","_meta");c.src="user/"+file_name+"_meta.js";c.onload=function(){init3()};document.head.appendChild(c)};document.head.appendChild(b)}}else{init3()}}function init3(){latest_ws=ws;myCanvas.onmousedown=holdon;myCanvas.onmouseup=holdoff;myCanvas.onmouseout=mouseout;myCanvas.onmousemove=movemouse;if(myCanvas.addEventListener){myCanvas.addEventListener("mousewheel",mousewheel,false);
myCanvas.addEventListener("DOMMouseScroll",mousewheel,false);myCanvas.addEventListener("MozMousePixelScroll",mousewheel,false)}else{if(myCanvas.attachEvent){myCanvas.attachEvent("onmousewheel",mousewheel)}}if(document.addEventListener){document.addEventListener("mousewheel",mousewheel_pd,false);document.addEventListener("DOMMouseScroll",mousewheel_pd,false);document.addEventListener("MozMousePixelScroll",mousewheel_pd,false)}else{if(document.attachEvent){document.attachEvent("onmousewheel",mousewheel_pd)}}readintree();Resize_only();if((genus_URL||taxa_URL)&&(animation_status==1)){search_init()}else{if(!genus_URL&&!taxa_URL&&animation_status!=-2&&animation_status!=-3){animation_status=-1}justopened=true;Reset();draw2();setTimeout("cancelfirstuse()",5000);if(init_URL&&(init_URL==4)){buttonoptions=2;document.getElementById("closebutton").style.display="";document.getElementById("growtitle").style.display="";document.getElementById("growtxt").style.display="";document.getElementById("revgbutton").style.display="";document.getElementById("pausegbutton").style.display="";document.getElementById("playgbutton").style.display="";document.getElementById("endgbutton").style.display="";growplay();Resize()}}}function init_logos(){if($("#myCanvas").attr("data_status")=="embedded"||$("#myCanvas").attr("data_status")=="embedded_front"){$("#logo1").hide();return}if(logo_URL){document.getElementById("logo1").style.display="initial";document.getElementById("logo1").src=logo_URL;document.getElementById("logo1").onload=function(){Resize_only();draw2()};var a="OneZoom Tree of Life Explorer";if(title_add1){a+=" "+title_add1}if(title_add2){a+=" "+title_add2}document.title=a}else{if(url_URL){$("#logo1").attr("src","icons/Home_icon.png");$("#logo1").show()}else{$("#logo1").hide()}}}function readintree(){var a=document.forms.myform["datain"].value;fulltree=null;if(a){fulltree=new midnode(a)}else{userdata()}fulltree.richness_calc();fulltree.traitprecalc();if(auto_interior_node_labels){fulltree.name_calc()}fulltree.phylogeneticdiv_calc();fulltree.age_calc();if(auto_interior_node_labels){fulltree.inlabel_calc(null)}update_form();Resize();fulltree.setxyr3r(40,widthres-40,40,heightres-40);wsinit=ws;loadingcontent=false}function Resize_only(){widthres=1024;heightres=660;if(document.body&&document.body.offsetWidth){widthres=document.body.offsetWidth;winH=document.body.offsetHeight}if(document.compatMode=="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){widthres=document.documentElement.offsetWidth;heightres=document.documentElement.offsetHeight}if(window.innerWidth&&window.innerHeight){widthres=document.getElementById("wholecontainer").offsetWidth;heightres=document.getElementById("wholecontainer").offsetHeight}if($("#myCanvas").attr("data_status")=="embedded"||$("#myCanvas").attr("data_status")=="embedded_front"){top_page_gap=255}var a=widthres-top_page_gap;if(document.getElementById("logo1").style.display!="none"){a-=parseInt(document.getElementById("logo1").width)}document.getElementById("headerspace").width=a;if(($("#myCanvas").attr("data_status")!="embedded"&&$("#myCanvas").attr("data_status")!="embedded_front")&&$("#myCanvas").attr("data_status")!="front_iframe"){heightres-=60;widthres-=30}document.getElementById("headerspace2").style.display="none";if(buttonoptions!=0){document.getElementById("headerspace2").style.display="";heightres=heightres-40;if(widthres<widthofcontrols){heightres=heightres-27;if(widthres<widthofcontrols/2){heightres=heightres-27;if(widthres<widthofcontrols/3){heightres=heightres-27}}}}if(((infotype!=0||growing||growingpause)&&(buttonoptions==0))){heightres-=42;if(widthres<widthofinfobar){heightres-=42}}if(widthres<widthofcontrols2){heightres=heightres-27;if(widthres<widthofcontrols2/2){heightres=heightres-27;if(widthres<widthofcontrols2/3){heightres=heightres-27}}}myCanvas.width=widthres;myCanvas.height=heightres}function Resize(){Resize_only();draw2()}function cancelfirstuse(){justopened=false;draw2()}function usersearchclear(){document.getElementById("searchtf").value="";justopened=false;clearTimeout(t);flying=false;performclear();fulltree.clearsearch();fulltree.clearonroute();document.getElementById("numhittxt").innerHTML=("no hits")}function userReset(){if(!introlock){popup_out();justopened=false;if((genus_URL||taxa_URL)){Reset();var a=viewtype;set_defaults();if(viewtype!=a){update_form();Resize()}highlight_search=true;fulltree.search_URLinit();if(genus2_URL||taxa2_URL){fulltree.search_URLinit2()}draw2()}else{Reset()}}}function Reset(){threshold=2;if((growing)||(growingpause)){clearTimeout(t);draw2();timelim=-1;Resize();growing=false;growingpause=false;Resize()}document.getElementById("numhittxt").innerHTML=("no hits");calculating=false;clearTimeout(t);flying=false;clearTimeout(t2);performclear();timelim=-1;fulltree.deanchor();fulltree.graphref=true;fulltree.clearsearch();fulltree.clearonroute();fulltree.setxyr3r(40,widthres-40,40,heightres-40);wsinit=ws;Resize_only();draw2()}var clicking;
function holdon(a){if(typeof use_image_before_loading!="undefined"){use_image_before_loading=false}if(animation_status==-1){animation_status=-3}else{if(animation_status==2){animation_status=-2}else{if(animation_status==0){animation_status=1}else{if(animation_status==1){return}}}}if(draft_only==true){draft_only=false;init();return}if((genus_URL||taxa_URL)&&(animation_status==1)){search_init()}if(!introlock||in_about){if(in_about){AboutOZ()}justopened=false;clearTimeout(t);flying=false;mouseY=a.clientY-myCanvas.offsetTop;mouseX=a.clientX-myCanvas.offsetLeft;if(mouse_on_url_valid){mousehold=false;buttonhold=true;calculating=true;draw2();calculating=false}else{mousehold=true;clicking=true;oldyp=yp;oldxp=xp;setTimeout("clicktoolate()",200)}}}function clicktoolate(){clicking=false}function holdoff(){if(!introlock){if(mouse_on_url_valid){about_to_open_url=mouse_on_url;about_to_open_url_new=mouse_on_url_new;mouse_on_url_valid=false;mouse_on_url=null;justopened_url=true;buttonhold=false;mousehold=false;draw2();if(about_to_open_url_new){mywindow=window.open(about_to_open_url)}else{window.location.href=about_to_open_url}}if(clicking){click2zoomnum=4;click2zoom()}buttonhold=false;mousehold=false;calculating=false}}function mouseout(){mousehold=false;calculating=false;mouseX=-1;mouseY=-1;draw2()}function movemouse(a){justopened_url=false;if(mousehold){yp=oldyp+(-mouseY+a.clientY-myCanvas.offsetTop);xp=oldxp+(-mouseX+a.clientX-myCanvas.offsetLeft);if((yp-oldyp)^2>9){clicking=false}if((xp-oldxp)^2>9){clicking=false}draw2()}else{mouseY=a.clientY-myCanvas.offsetTop;mouseX=a.clientX-myCanvas.offsetLeft;calculating=true;draw2();calculating=false}}function mousewheel_pd(a){if($(myCanvas).attr("data_status")=="embedded"){a.preventDefault();a.stopPropagation();return false}if(embed_tool_htm){}else{a.preventDefault();a.stopPropagation();return false}}function mousewheel(a){a.preventDefault();a.stopPropagation();if(typeof use_image_before_loading!="undefined"){use_image_before_loading=false}if(animation_status!=0){if(animation_status==-1){animation_status=-3}else{if(animation_status==2){animation_status=-2}}if(draft_only==true){draft_only=false;init();return}if(!introlock){justopened=false;if(!calculating){clearTimeout(t);flying=false;if(!mousehold){var b=0;if("wheelDelta" in a){b=a.wheelDelta}else{b=-a.detail/2}if((parseFloat(b))>0){calculating=true;zoomin(a)}else{calculating=true;zoomout(a)}}setTimeout("calcfalse()",1)}}else{if(in_about){AboutOZ()}}}return false}function calcfalse(){calculating=false}function zoomin(a){clearTimeout(t);mouseY=a.clientY-myCanvas.offsetTop;mouseX=a.clientX-myCanvas.offsetLeft;flying=false;ws=ws/sensitivity;xp=mouseX+(xp-mouseX)/sensitivity;yp=mouseY+(yp-mouseY)/sensitivity;draw2()}function zoomout(a){mouseY=a.clientY-myCanvas.offsetTop;mouseX=a.clientX-myCanvas.offsetLeft;clearTimeout(t);flying=false;if((((fulltree).rvar*(fulltree.hxmax-fulltree.hxmin))>(widthres*0.7))||(((fulltree).rvar*(fulltree.hymax-fulltree.hymin))>(heightres*0.7))){ws=ws*sensitivity;xp=mouseX+(xp-mouseX)*sensitivity;yp=mouseY+(yp-mouseY)*sensitivity;draw2()}}var click2zoomnum;function click2zoom(){clearTimeout(t);flying=false;ws=ws/sensitivity3;xp=mouseX+(xp-mouseX)/sensitivity3;yp=mouseY+(yp-mouseY)/sensitivity3;draw2();click2zoomnum--;if(click2zoomnum>=0){t=setTimeout("click2zoom()",33)}}function CZoomin(){if(!introlock){if(zoominnum>0){zoominnum--}click2zoomnum=4;CZoomin2()}}function CZoomout(){if(!introlock){if(zoomoutnum>0){zoomoutnum--}click2zoomnum=4;CZoomout2()}}function CZoomin2(){clearTimeout(t);flying=false;ws=ws/sensitivity2;xp=widthres/2+(xp-widthres/2)/sensitivity2;yp=heightres/2+(yp-heightres/2)/sensitivity2;draw2();click2zoomnum--;if(click2zoomnum>=0){t=setTimeout("CZoomin2()",33)}}function CZoomout2(){clearTimeout(t);flying=false;if((((fulltree).rvar*(fulltree.hxmax-fulltree.hxmin))>(widthres*0.7))||(((fulltree).rvar*(fulltree.hymax-fulltree.hymin))>(heightres*0.7))){ws=ws*sensitivity2;xp=widthres/2+(xp-widthres/2)*sensitivity2;yp=heightres/2+(yp-heightres/2)*sensitivity2;draw2()}click2zoomnum--;if(click2zoomnum>=0){t=setTimeout("CZoomout2()",33)}}var polytype=3;var viewtype=1;var colourtype=3;var commonlabels=true;var drawsignposts=true;var leaftype=2;var int_highlight_type=2;var fonttype="Helvetica";var intcircdraw=true;var sign_background_size=0.35;var sign_text_size=0.265;var pieborder=0.12;var partl2=0.1;var total_num_polyt=3;var total_num_cols=3;var sensitivity=0.84;var sensitivity3=0.9;var sensitivity2=0.88;var mintextsize=4;var threshold=2;var thresholdtxt=2;var growthtimetot=30;var allowurlparse=true;var title_add1=null;var title_add2=null;var length_init_zoom2=30;var init_zoom_speed=1.1;var length_intro_in=15;var length_intro_in2=8;var credits_roll_speed=1.8;var about_height=12;var top_page_gap=614;var leaf_outline_def="rgb(0,150,30)";var leaf_fill_def="rgb(0,100,0)";var leaf_text_col_def="rgb(255,255,255)";var brown_branch_def="rgb(100,75,50)";var signpost_col_def="rgba(255,255,255,0.5)";var signpost_txtcol_def="rgb(0,0,0)";
var popupbox_col="rgba(0,0,0,0.85)";var popupbox_txtcol="rgb(255,255,255)";var loading_txtcol="rgb(0,0,0)";var pie_background_color="rgb(255,255,255)";var link_background_color="rgb(255,255,255)";var link_highlight_color="rgb(0,0,0)";var intnodetextcolor="rgb(255,255,255)";var backgroundcolor="rgb(255,255,200)";var outlineboxcolor="rgb(0,0,0)";var highlightcolor1="rgba(255,255,255,0.5)";var highlightcolor2="rgba(0,0,0,0.5)";function set_defaults(){if(UserOptions.polytype){polytype=UserOptions.polytype}if(UserOptions.viewtype){viewtype=UserOptions.viewtype}if(UserOptions.colourtype){colourtype=UserOptions.colourtype}if(UserOptions.commonlabels){commonlabels=bin_parse(UserOptions.commonlabels,commonlabels)}if(UserOptions.drawsignposts){drawsignposts=bin_parse(UserOptions.drawsignposts,drawsignposts)}if(UserOptions.leaftype){leaftype=UserOptions.leaftype}if(UserOptions.int_highlight_type){int_highlight_type=UserOptions.int_highlight_type}if(UserOptions.fonttype){fonttype=UserOptions.fonttype}if(UserOptions.intcircdraw){intcircdraw=bin_parse(UserOptions.intcircdraw,intcircdraw)}if(UserOptions.sign_background_size){sign_background_size=UserOptions.sign_background_size}if(UserOptions.sign_text_size){sign_text_size=UserOptions.sign_text_size}if(UserOptions.pieborder){pieborder=UserOptions.pieborder}if(UserOptions.partl2){partl2=UserOptions.partl2}if(UserOptions.total_num_polyt){total_num_polyt=UserOptions.total_num_polyt}if(UserOptions.total_num_cols){total_num_cols=UserOptions.total_num_cols}if(UserOptions.sensitivity){sensitivity=UserOptions.sensitivity}if(UserOptions.sensitivity3){sensitivity3=UserOptions.sensitivity3}if(UserOptions.sensitivity2){sensitivity2=UserOptions.sensitivity2}if(UserOptions.mintextsize){mintextsize=UserOptions.mintextsize}if(UserOptions.threshold){threshold=UserOptions.threshold}if(UserOptions.thresholdtxt){thresholdtxt=UserOptions.thresholdtxt}if(UserOptions.growthtimetot){growthtimetot=UserOptions.growthtimetot}if(UserOptions.allowurlparse){allowurlparse=bin_parse(UserOptions.allowurlparse,allowurlparse)}else{allowurlparse=false}if(UserOptions.length_init_zoom2){length_init_zoom2=UserOptions.length_init_zoom2}if(UserOptions.init_zoom_speed){init_zoom_speed=UserOptions.init_zoom_speed}if(UserOptions.length_intro_in){length_intro_in=UserOptions.length_intro_in}if(UserOptions.length_intro_in2){length_intro_in2=UserOptions.length_intro_in2}if(UserOptions.titleadd1){title_add1=UserOptions.titleadd1}if(UserOptions.titleadd2){title_add2=UserOptions.titleadd2}if(UserOptions.leaf_outline_def){leaf_outline_def=UserOptions.leaf_outline_def}if(UserOptions.leaf_fill_def){leaf_fill_def=UserOptions.leaf_fill_def}if(UserOptions.leaf_text_col_def){leaf_text_col_def=UserOptions.leaf_text_col_def}if(UserOptions.brown_branch_def){brown_branch_def=UserOptions.brown_branch_def}if(UserOptions.signpost_col_def){signpost_col_def=UserOptions.signpost_col_def}if(UserOptions.signpost_txtcol_def){signpost_txtcol_def=UserOptions.signpost_txtcol_def}if(UserOptions.popupbox_col){popupbox_col=UserOptions.popupbox_col}if(UserOptions.popupbox_txtcol){popupbox_txtcol=UserOptions.popupbox_txtcol}if(UserOptions.loading_txtcol){loading_txtcol=UserOptions.loading_txtcol}if(UserOptions.pie_background_color){pie_background_color=UserOptions.pie_background_color}if(UserOptions.link_background_color){link_background_color=UserOptions.link_background_color}if(UserOptions.link_highlight_color){link_highlight_color=UserOptions.link_highlight_color}if(UserOptions.intnodetextcolor){intnodetextcolor=UserOptions.intnodetextcolor}if(UserOptions.backgroundcolor){backgroundcolor=UserOptions.backgroundcolor}if(UserOptions.outlineboxcolor){outlineboxcolor=UserOptions.outlineboxcolor}if(UserOptions.highlightcolor1){highlightcolor1=UserOptions.highlightcolor1}if(UserOptions.highlightcolor2){highlightcolor2=UserOptions.highlightcolor2}if(allowurlparse){URL_parse()}}function bin_parse(c,d){var a=d;var b=["1","true","yes","y","t"];var e=["0","false","no","n","f"];for(i=0;i<b.length;i++){if(c==b[i]){a=true}if(c==e[i]){a=false}}return a}var l1col_URL=null,l2col_URL=null,b1col_URL=null,b2col_URL=null,txtcol_URL=null;var genus_URL=null,species_URL=null,taxa_URL=null,genus2_URL=null,species2_URL=null,taxa2_URL=null;var init_URL=3,url_URL=null,text_URL=null,logo_URL=null,sitename_URL=null,profile_URL=null,cutdown_URL=null,info_URL=null;var leaf_link_priority=null,node_link_priority=null;function URL_parse(){l1col_URL=null;l2col_URL=null;b1col_URL=null;b2col_URL=null;txtcol_URL=null;genus_URL=null;species_URL=null;taxa_URL=null;genus2_URL=null;species2_URL=null;taxa2_URL=null;init_URL=3;url_URL=null;text_URL=null;logo_URL=null;sitename_URL=null;profile_URL=null;cutdown_URL=null;info_URL=null;leaf_link_priority=null;node_link_priority=null;var b;if(window.location.search.length>1){b=window.location.search}else{b=window.location.hash}b=b.split("%20").join(" ");if(this_url=b.substring(1)){this_url=this_url.toString();var e=this_url.split("&");for(var a=0;
a<e.length;a++){var d=e[a];tempURLparts=d.split("=");if(tempURLparts[0]=="profile"){profile_URL=tempURLparts[1];for(var c=0;c<PartnerProfiles.length;c++){if(PartnerProfiles[c]){if(PartnerProfiles[c].profilename==profile_URL){if(PartnerProfiles[c].poly){polytype=PartnerProfiles[c].poly}if(PartnerProfiles[c].view){viewtype=PartnerProfiles[c].view}if(PartnerProfiles[c].colour){colourtype=PartnerProfiles[c].colour}if(PartnerProfiles[c].common){commonlabels=bin_parse(PartnerProfiles[c].common,commonlabels)}if(PartnerProfiles[c].signs){drawsignposts=bin_parse(PartnerProfiles[c].signs,drawsignposts)}if(PartnerProfiles[c].ltype){leaftype=PartnerProfiles[c].ltype}if(PartnerProfiles[c].hltype){int_highlight_type=PartnerProfiles[c].hltype}if(PartnerProfiles[c].bgcol){backgroundcolor=PartnerProfiles[c].bgcol}if(PartnerProfiles[c].font){fonttype=PartnerProfiles[c].font}if(PartnerProfiles[c].init){init_URL=PartnerProfiles[c].init}if(PartnerProfiles[c].url){url_URL=PartnerProfiles[c].url}if(PartnerProfiles[c].text){text_URL=PartnerProfiles[c].text}if(PartnerProfiles[c].logo){logo_URL=PartnerProfiles[c].logo}if(PartnerProfiles[c].name){sitename_URL=PartnerProfiles[c].name}if(PartnerProfiles[c].titleadd2){title_add2=PartnerProfiles[c].titleadd2}if(PartnerProfiles[c].info){info_URL=bin_parse(PartnerProfiles[c].info,info_URL)}if(PartnerProfiles[c].growt){growthtimetot=PartnerProfiles[c].growt}if(PartnerProfiles[c].leaf_link_priority){leaf_link_priority=PartnerProfiles[c].leaf_link_priority}if(PartnerProfiles[c].node_link_priority){node_link_priority=PartnerProfiles[c].node_link_priority}}}}}}for(ii=0;ii<e.length;ii++){var d=e[ii];tempURLparts=d.split("=");if(tempURLparts[0]=="poly"){polytype=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="view"){viewtype=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="colour"){colourtype=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="common"){commonlabels=bin_parse(tempURLparts[1])}else{if(tempURLparts[0]=="signs"){drawsignposts=bin_parse(tempURLparts[1])}else{if(tempURLparts[0]=="ltype"){leaftype=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="hltype"){int_highlight_type=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="bgcol"){backgroundcolor=tempURLparts[1]}else{if(tempURLparts[0]=="l1col"){l1col_URL=tempURLparts[1]}else{if(tempURLparts[0]=="l2col"){l2col_URL=tempURLparts[1]}else{if(tempURLparts[0]=="b1col"){b1col_URL=tempURLparts[1]}else{if(tempURLparts[0]=="b2col"){b2col_URL=tempURLparts[1]}else{if(tempURLparts[0]=="h1col"){highlightcolor1=tempURLparts[1]}else{if(tempURLparts[0]=="h2col"){highlightcolor2=tempURLparts[1]}else{if(tempURLparts[0]=="txtcol"){txtcol_URL=tempURLparts[1]}else{if(tempURLparts[0]=="font"){fonttype=tempURLparts[1]}else{if(tempURLparts[0]=="genus"){genus_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="species"){species_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="taxa"){taxa_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="genus2"){genus2_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="species2"){species2_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="taxa2"){taxa2_URL=tempURLparts[1].toLowerCase()}else{if(tempURLparts[0]=="init"){init_URL=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="url"){url_URL=tempURLparts[1]}else{if(tempURLparts[0]=="text"){text_URL=tempURLparts[1]}else{if(tempURLparts[0]=="name"){sitename_URL=tempURLparts[1]}else{if(tempURLparts[0]=="logo"){logo_URL=tempURLparts[1]}else{if(tempURLparts[0]=="cutdown"){cutdown_URL=bin_parse(tempURLparts[1])}else{if(tempURLparts[0]=="info"){info_URL=bin_parse(tempURLparts[1])}else{if(tempURLparts[0]=="growt"){growthtimetot=parseFloat(tempURLparts[1])}else{if(tempURLparts[0]=="initt1"){length_intro_in=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="initt1b"){length_intro_in2=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="initt2"){length_init_zoom2=parseInt(tempURLparts[1])}else{if(tempURLparts[0]=="inits2"){init_zoom_speed=parseFloat(tempURLparts[1])}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(((l1col_URL||l2col_URL)||(b1col_URL||b2col_URL))||(txtcol_URL)){total_num_cols++;colourtype=total_num_cols}}}midnode.prototype.datefull=function(){if(this.lengthbr>10){return(Math.round((this.lengthbr)*10)/10).toString()+" Million years ago ("+gpmapper(this.lengthbr)+")"}else{if(this.lengthbr>1){return(Math.round((this.lengthbr)*100)/100).toString()+" Million years ago ("+gpmapper(this.lengthbr)+")"}else{return(Math.round((this.lengthbr)*10000)/10).toString()+" Thousand years ago ("+gpmapper(this.lengthbr)+")"}}};midnode.prototype.datemed=function(){if(this.lengthbr>10){return(Math.round((this.lengthbr)*10)/10).toString()+" Million years ago"}else{if(this.lengthbr>1){return(Math.round((this.lengthbr)*100)/100).toString()+" Million years ago"}else{return(Math.round((this.lengthbr)*10000)/10).toString()+" Thousand years ago"}}};midnode.prototype.datepart=function(){if(this.lengthbr>10){return(Math.round((this.lengthbr)*10)/10).toString()+" Mya"
}else{if(this.lengthbr>1){return(Math.round((this.lengthbr)*100)/100).toString()+" Mya"}else{return(Math.round((this.lengthbr)*10000)/10).toString()+" Kya"}}};function gpmapper(a){if(a>419.2){return("pre Devonian")}else{if(a>359.2){return("Devonian")}else{if(a>298.9){return("Carboniferous")}else{if(a>252.2){return("Permian")}else{if(a>203.6){return("Triassic")}else{if(a>150.8){return("Jurassic")}else{if(a>70.6){return("Cretaceous")}else{if(a>28.4){return("Paleogene")}else{if(a>3.6){return("Neogene")}else{return("Quaternary")}}}}}}}}}}midnode.prototype.iprimaryname=function(){if(commonlabels){if(this.child1){return(metadata.node_meta[this.metacode][metadata_cnp_node-1])}else{return(metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1])}}else{if(this.child1){return(this.name1)}else{return(this.name2+" "+this.name1)}}};midnode.prototype.isecondaryname=function(){if(commonlabels){if(this.child1){return(this.name1)}else{return(this.name2+" "+this.name1)}}else{if(this.child1){if(metadata.node_meta[this.metacode][metadata_cnp_node-1]!=""){return(metadata.node_meta[this.metacode][metadata_cnp_node-1])}else{return null}}else{if(metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1]!=""){return(metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1])}else{return null}}}};function autotext(h,f,d,c,e,g){var b=false;if(g>mintextsize){context.textBaseline="middle";context.textAlign="left";if(h){context.font="italic "+(g).toString()+"px "+fonttype}else{context.font=(g).toString()+"px "+fonttype}var a=context.measureText(f).width;if(a>e){if((g*e/a)>mintextsize){if(h){context.font="italic "+(g*e/a).toString()+"px "+fonttype}else{context.font=(g*e/a).toString()+"px "+fonttype}context.fillText(f,d-e/2,c);b=true}}else{context.fillText(f,d-(a)/2,c);b=true}}return b}function autotext2(f,k,c,b,e,d){var g=false;if(d>mintextsize){context.textBaseline="middle";context.textAlign="center";if(f){context.font="italic "+(d).toString()+"px "+fonttype}else{context.font=(d).toString()+"px "+fonttype}var m=(k.length)/3;var l=k.split(" ");var j=" ";var h=" ";if(l.length==1){g=autotext(f,k,c,b,e,d)}else{if(l.length==2){j=(l[0]);h=(l[1])}else{for(i=(l.length-1);i>=0;i--){if((h.length)>m){j=(" "+l[i]+j)}else{h=(" "+l[i]+h)}}}var a=context.measureText(h).width;if(a<(context.measureText(j).width)){a=context.measureText(j).width}if(a>e){if((d*e/a)>mintextsize){if(f){context.font="italic "+(d*e/a).toString()+"px "+fonttype}else{context.font=(d*e/a).toString()+"px "+fonttype}context.fillText(j,c,b-d*e/a/1.7);context.fillText(h,c,b+d*e/a/1.7);g=true}}else{context.fillText(j,c,b-d/1.7);context.fillText(h,c,b+d/1.7);g=true}}}return g}function autotext3(g,l,c,b,e,d){var h=false;if(d>mintextsize){context.textBaseline="middle";context.textAlign="center";if(g){context.font="italic "+(d).toString()+"px "+fonttype}else{context.font=(d).toString()+"px "+fonttype}var n=(l.length)/4;var m=l.split(" ");var k=" ";var j=" ";var f=" ";if(m.length==1){h=autotext(g,l,c,b,e,d*3)}else{if(m.length==2){h=autotext2(g,l,c,b,e,d*2)}else{if(m.length==3){k=(m[0]);j=(m[1]);f=(m[2])}else{for(var o=(m.length-1);o>=0;o--){if((f.length)>=n){if((j.length)>=n){k=(" "+m[o]+k)}else{j=(" "+m[o]+j)}}else{f=(" "+m[o]+f)}}}}if((f.length>=(k.length+j.length))||(k.length>=(f.length+j.length))){h=autotext2(g,l,c,b,e,d)}else{var a=context.measureText(j).width;if(a<(context.measureText(k).width)){a=context.measureText(k).width}if(a<(context.measureText(f).width)){a=context.measureText(f).width}if(a>e){if((d*e/a)>mintextsize){if(g){context.font="italic "+(d*e/a).toString()+"px "+fonttype}else{context.font=(d*e/a).toString()+"px "+fonttype}context.fillText(k,c,b-d*e/a*1.2);context.fillText(j,c,b);context.fillText(f,c,b+d*e/a*1.2);h=true}}else{context.fillText(k,c,b-d*1.2);context.fillText(j,c,b);context.fillText(f,c,b+d*1.2);h=true}}}}return h}function drawArc(a,g,f,b,e,d,c){context.fillStyle=c;context.beginPath();context.arc(a,g,f,b,e,d);context.fill()}midnode.prototype.draw=function(){this.ing=false;var a,c,b;if(this.rvar){a=this.xvar;c=this.yvar;b=this.rvar}if(this.shouldDrawChildren()){this.drawChildren()}if(this.shouldDrawBranch()){this.drawBranch()}if(this.dvar&&(this.lengthbr>timelim)){if(this.shouldDrawFakeLeaf()){this.drawFakeLeaf()}else{if(this.ing&&this.child1){this.drawInternal()}else{if(this.ing){this.drawLeaf()}}}}if(this.dvar&&(this.lengthbr<=timelim)){if(this.richness_val>1){this.growthleaflogic(a+((b)*(this.arcx)),c+(b)*(this.arcy),b*leafmult*0.5*0.4,this.arca)}else{this.drawLeaf()}}};midnode.prototype.drawChildren=function(){if((this.child1.richness_val)>=(this.child2.richness_val)){this.child1.draw();this.child2.draw()}else{this.child2.draw();this.child1.draw()}};midnode.prototype.shouldDrawChildren=function(){if(this.dvar&&this.child1&&this.lengthbr>timelim){return true}else{return false}};midnode.prototype.shouldDrawBranch=function(){if(this.dvar&&((this.gvar)&&((polytype!=2)||(this.npolyt)))){return true}else{return false}};midnode.prototype.shouldDrawFakeLeaf=function(){var a;
if(this.rvar){a=this.rvar}if((this.richness_val>1)&&(a<=threshold)&&(timelim<=0)){return true}return false};midnode.prototype.drawFakeLeaf=function(){var b;var a;var c;if(this.rvar){a=this.xvar;c=this.yvar;b=this.rvar}this.fakeleaflogic(a+((b)*(this.nextx1)),c+(b)*(this.nexty1),b*leafmult*0.75*0.4,this.arca)};midnode.prototype.drawLeaf=function(){var a;var c;var b;if(this.rvar){a=this.xvar;c=this.yvar;b=this.rvar}this.tipleaflogic(a+((b)*this.arcx),c+(b)*this.arcy,b*this.arcr,this.arca);if((b*leafmult)>threshold*10){if(b>thresholdtxt*85){this.drawLeafTextDetail(a+b*this.arcx,c+b*this.arcy,b*this.arcr*0.77)}else{if(b>thresholdtxt*15){this.drawLeafTextRough(a+b*this.arcx,c+b*this.arcy,b*this.arcr*0.77)}}}};midnode.prototype.drawSignPost=function(){if(this.shouldDrawSignPost()){this.drawSPofThisNode()}else{if(this.shouldChildrenDrawSignPost()){this.child1.drawSignPost();this.child2.drawSignPost()}}};midnode.prototype.shouldDrawSignPost=function(){var a;if(this.rvar){a=this.rvar}if(this.dvar&&this.richness_val>1&&drawsignposts&&this.child1){if(((thresholdtxt*35<a*(this.hxmax-this.hxmin))&&(a<=thresholdtxt*50))||(this.lengthbr<=timelim)){if((this.name1&&(!commonlabels))||(metadata.node_meta[this.metacode][metadata_cnp_node-1]&&(commonlabels))){return true}}}return false};midnode.prototype.shouldChildrenDrawSignPost=function(){var a;if(this.rvar){a=this.rvar}if(this.dvar&&this.richness_val>1&&drawsignposts&&this.child1&&this.lengthbr>timelim){if(((thresholdtxt*35<a*(this.hxmax-this.hxmin))&&(a<=thresholdtxt*50))||(this.lengthbr<=timelim)){if(!(this.name1&&(!commonlabels))&&!(metadata.node_meta[this.metacode][metadata_cnp_node-1]&&(commonlabels))){return true}}else{return true}}return false};function infobar(){document.getElementById("textout").innerHTML="";if(growing||growingpause||(infotype!=0)||buttonoptions!=0){document.getElementById("textout").style.display=""}else{document.getElementById("textout").style.display="none"}var b="textout";if(buttonoptions==5){b="viewtxt2"}if(buttonoptions==5||buttonoptions==0){if(infotype==3){var a=ws/wsinit/fulltree.mult();if(a<2500){document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >Current zoom level is '+(Math.round(a*10)/10).toString()+" times magnification </FONT> ")}else{if(a<1500000){document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >Current zoom level is '+(Math.round(a/1000)).toString()+" thousand times magnification </FONT> ")}else{document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >Current zoom level is '+(Math.round(a/100000)/10).toString()+" million times magnification </FONT> ")}}}else{if(infotype==4){var a=ws/wsinit/fulltree.mult();var c=a*widthres/8661.4;if(c<1.5){document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >The complete image now measures at least '+(Math.round(c*1000)/10).toString()+" Centimeters across </FONT>")}else{if(c>1500){document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >The complete image now measures at least '+(Math.round(c/100)/10).toString()+" Kilometers across </FONT>")}else{document.getElementById(b).innerHTML=('<FONT COLOR="FFFFFF" >The complete image now measures at least '+((Math.round(c*10))/10).toString()+" Meters across </FONT>")}}}else{document.getElementById("viewtxt2").style.display="none"}}}b="growtxt";if(buttonoptions!=2){b="textout"}if(buttonoptions==2||buttonoptions==0){if((growingpause||growing)){if(timelim>=0){if(timelim>10){document.getElementById(b).innerHTML='<FONT COLOR="FFFFFF" >'+(Math.round(timelim*10)/10).toString()+" Million years ago - "+gpmapper(timelim)+" Period </FONT>"}else{if(timelim>1){document.getElementById(b).innerHTML='<FONT COLOR="FFFFFF" >'+(Math.round(timelim*100)/100).toString()+" Million years ago - "+gpmapper(timelim)+" Period </FONT>"}else{document.getElementById(b).innerHTML='<FONT COLOR="FFFFFF" >'+(Math.round(timelim*10000)/10).toString()+" Thousand years ago - "+gpmapper(timelim)+" Period </FONT>"}}if(growingpause){document.getElementById(b).innerHTML+='<FONT COLOR="FFFFFF" >  (paused) </FONT>'}}}else{if(buttonoptions==2){document.getElementById("growtxt").innerHTML='<FONT COLOR="FFFFFF" > Present day </FONT>'}}}}function drawopen(){var d;context.fillStyle=popupbox_col;context.beginPath();context.lineTo(myCanvas.width-375,40);context.lineTo(myCanvas.width-375,10);context.lineTo(myCanvas.width-187,10);context.lineTo(myCanvas.width-187,40);context.fill();context.beginPath();context.lineTo(myCanvas.width-177,40);context.lineTo(myCanvas.width-177,10);context.lineTo(myCanvas.width-10,10);context.lineTo(myCanvas.width-10,40);context.fill();d=document.getElementById("help_icon").getBoundingClientRect();var c=(d.right+d.left)/2-myCanvas.offsetLeft;context.beginPath();context.fillStyle=popupbox_col;context.lineTo(c+10,10);context.lineTo(c-10,10);context.lineTo(c,0);context.fill();d=document.getElementById("zoomin_icon").getBoundingClientRect();var c=(d.right+d.left)/2-myCanvas.offsetLeft;context.beginPath();context.fillStyle=popupbox_col;context.lineTo(c+10,10);
context.lineTo(c-10,10);context.lineTo(c,0);context.fill();d=document.getElementById("zoomout_icon").getBoundingClientRect();var c=(d.right+d.left)/2-myCanvas.offsetLeft;context.beginPath();context.fillStyle=popupbox_col;context.lineTo(c+10,10);context.lineTo(c-10,10);context.lineTo(c,0);context.fill();d=document.getElementById("about_icon").getBoundingClientRect();var b=Math.max(d.right-myCanvas.offsetLeft,280);context.beginPath();context.lineWidth=1;context.lineTo(10,40);context.lineTo(10,10);context.lineTo(b,10);context.lineTo(b,40);context.fillStyle=popupbox_col;context.fill();d=document.getElementById("OZlogo").getBoundingClientRect();var a=(d.right+d.left)/2-myCanvas.offsetLeft;context.beginPath();context.fillStyle=popupbox_col;context.lineTo(a+10,10);context.lineTo(a-10,10);context.lineTo(a,0);context.fill();context.fillStyle=popupbox_txtcol;autotext(false,"Click for a tutorial",myCanvas.width-93,25,250,14);autotext(false,"Click or scroll to zoom",myCanvas.width-281,25,250,14);if(sitename_URL){autotext(false,"Links to OneZoom and "+sitename_URL,(10+b)/2,25,250,14);d=document.getElementById("logo1").getBoundingClientRect();var a=(d.right+d.left)/2-myCanvas.offsetLeft;context.beginPath();context.fillStyle=popupbox_col;context.lineTo(a+10,10);context.lineTo(a-10,10);context.lineTo(a,0);context.fill()}else{autotext(false,"See more trees on OneZoom",(10+b)/2,25,250,14)}}function drawUsingImage(){context.clearRect(0,0,widthres,heightres);context.drawImage(preload_image,0,0,widthres,heightres);var a;if(animation_status==-1||animation_status==2){a="Click to explore and scroll to zoom"}else{if(animation_status==0){a="Click to see animation";if(typeof front_page_bottom_text!="undefined"){a=front_page_bottom_text}}else{return}}context.fillStyle="rgba(0,0,0,0.75)";if($("#myCanvas").attr("data_status")=="embedded_front"){context.fillRect(0,heightres-40,widthres,heightres)}if($("#myCanvas").attr("data_status")=="embedded"){context.fillRect(0,heightres-70,widthres,heightres)}context.fillStyle="rgba(255,255,255,1)";if($("#myCanvas").attr("data_status")=="embedded_front"){autotext(false,a,widthres*0.5,heightres-20,widthres*0.7,30)}if($("#myCanvas").attr("data_status")=="embedded"){autotext(false,a,widthres*0.5,heightres-50,widthres*0.7,30)}}function draw2(){if(typeof use_image_before_loading!="undefined"&&use_image_before_loading==true){drawUsingImage();return}if(!loadingcontent){context.clearRect(0,0,widthres,heightres);if(backgroundcolor){context.fillStyle=backgroundcolor;context.fillRect(0,0,widthres,heightres)}mouse_on_url=null;mouse_on_url_new=true;mouse_on_url_valid=false;fulltree.drawreg(xp,yp,220*ws);if((((ws>100*latest_ws)||(ws<0.01*latest_ws))&&(!mousehold))){fulltree.reanchor();fulltree.drawreg(xp,yp,220*ws);latest_ws=ws;if((introlock&(viewtype!=2))||(flying&(viewtype!=2))){continue_flyB()}}fulltree.draw();fulltree.drawSignPost();context.beginPath();context.lineWidth=1;context.strokeStyle=outlineboxcolor;context.moveTo(0,0);var b=document.getElementById("myCanvas");context.lineTo(b.width,0);context.lineTo(b.width,b.height);context.lineTo(0,b.height);context.lineTo(0,0);context.stroke();infobar();if(justopened&&($("#myCanvas").attr("data_status")!="embedded"&&$("#myCanvas").attr("data_status")!="embedded_front")&&$("#myCanvas").attr("data_status")!="front_iframe"){drawopen()}if(popuptext){context.beginPath();context.lineWidth=1;context.lineTo(b.width-375,40);context.lineTo(b.width-375,10);context.lineTo(b.width-10,10);context.lineTo(b.width-10,40);context.fillStyle=popupbox_col;context.fill();context.fillStyle=popupbox_txtcol;autotext(false,popuptext,b.width-192,25,250,14)}if(popuptext2){var c=document.getElementById("about_icon").getBoundingClientRect();var a=Math.max(c.right-b.offsetLeft,280);context.beginPath();context.lineWidth=1;context.lineTo(10,40);context.lineTo(10,10);context.lineTo(a,10);context.lineTo(a,40);context.fillStyle=popupbox_col;context.fill();context.fillStyle=popupbox_txtcol;autotext(false,popuptext2,(10+a)/2,25,250,14)}if(in_about){about_draw()}if(debugtext){context.fillStyle=loading_txtcol;context.font="50px sans-serif";context.textAlign="center";context.fillText(debugtext,widthres/2,heightres/2,widthres/2)}if(($("#myCanvas").attr("data_status")!="embedded")&&$("#myCanvas").attr("data_status")!="embedded_front"){return}var d;if(animation_status==-1||animation_status==2){d="Click to explore and scroll to zoom"}else{if(animation_status==0){d="Click to see animation";if(typeof front_page_bottom_text!="undefined"){d=front_page_bottom_text}}else{return}}context.fillStyle="rgba(0,0,0,0.75)";if($("#myCanvas").attr("data_status")=="embedded_front"){context.fillRect(0,heightres-40,widthres,heightres)}if($("#myCanvas").attr("data_status")=="embedded"){context.fillRect(0,heightres-70,widthres,heightres)}context.fillStyle="rgba(255,255,255,1)";if($("#myCanvas").attr("data_status")=="embedded_front"){autotext(false,d,widthres*0.5,heightres-20,widthres*0.7,30)}if($("#myCanvas").attr("data_status")=="embedded"){autotext(false,d,widthres*0.5,heightres-50,widthres*0.7,30)
}}}var in_about=false;var about_upto=null;var about_target=null;var about_anim;function AboutOZ(){about_target=0;for(i=0;i<creditsText.length;i++){about_target+=creditsText[i][0]}about_target=about_target*about_height*1.5;popup_out();if(in_about){in_about=false;introlock=false;clearTimeout(about_anim);draw2()}else{about_upto=myCanvas.height*0.25;in_about=true;introlock=true;about_draw_anim()}}function about_draw_anim(){if(about_upto>=(myCanvas.height*0.25-about_target)){draw2();about_upto-=credits_roll_speed;about_anim=setTimeout("about_draw_anim()",33)}else{clearTimeout(about_anim);in_about=false;introlock=false;draw2()}}function about_draw(){context.fillStyle=backgroundcolor;context.fillRect(0,0,widthres,heightres);var a=about_upto;context.fillStyle=loading_txtcol;for(i=0;i<creditsText.length;i++){if(creditsText[i][1]){autotext(false,creditsText[i][1],myCanvas.width/2,a,myCanvas.width*0.8,about_height*creditsText[i][0])}a+=about_height*creditsText[i][0]*1.5}}function draw_loading(){infobar();Resize_only();if(backgroundcolor){context.fillStyle=backgroundcolor;context.fillRect(0,0,widthres,heightres)}else{context.clearRect(0,0,widthres,heightres)}context.beginPath();context.lineWidth=1;context.strokeStyle=outlineboxcolor;context.moveTo(0,0);var a=document.getElementById("myCanvas");context.lineTo(a.width,0);context.lineTo(a.width,a.height);context.lineTo(0,a.height);context.lineTo(0,0);context.stroke();context.beginPath();context.textBaseline="middle";context.textAlign="left";context.fillStyle=loading_txtcol;context.font="50px sans-serif";context.textAlign="center";context.fillText("Loading",widthres/2,heightres/2,widthres/2);return true}midnode.prototype.drawSPofThisNode=function(){var a;var d;var c;if(this.rvar){a=this.xvar;d=this.yvar;c=this.rvar}drawArc(a+c*(this.hxmax+this.hxmin)/2,d+c*(this.hymax+this.hymin)/2,c*((this.hxmax-this.hxmin)*sign_background_size),0,Math.PI*2,true,signpost_col_def);var b;if(this.name1&&!commonlabels){b=this.name1}else{if((metadata.node_meta[this.metacode][metadata_cnp_node-1])&&commonlabels){b=metadata.node_meta[this.metacode][metadata_cnp_node-1]}}context.fillStyle=signpost_txtcol_def;autotext3(true,b,a+c*(this.hxmax+this.hxmin)/2,d+c*(this.hymax+this.hymin)/2,c*(this.hxmax-this.hxmin)*sign_text_size*2,c*((this.hxmax-this.hxmin)*sign_text_size*2))};midnode.prototype.drawBranch=function(){var a;var f;var d;if(this.rvar){a=this.xvar;f=this.yvar;d=this.rvar}this.ing=true;context.lineCap="round";context.lineWidth=d*(this.bezr);context.beginPath();context.moveTo(a+d*(this.bezsx),f+d*this.bezsy);context.bezierCurveTo(a+d*(this.bezc1x),f+d*(this.bezc1y),a+d*(this.bezc2x),f+d*(this.bezc2y),a+d*(this.bezex),f+d*(this.bezey));context.strokeStyle=this.branchcolor();context.stroke();var e=false;if(this.should_highlight1()||this.should_highlight2()){e=true}if(e){var c=0.2;var b=0.2;if(this.should_highlight1()&&this.should_highlight2()){c=0.2;b=0.1}if(this.should_highlight1()){context.strokeStyle=this.highlightcolor();context.lineWidth=d*(this.bezr)*c;context.beginPath();context.moveTo(a+d*(this.bezsx),f+d*this.bezsy);context.bezierCurveTo(a+d*(this.bezc1x),f+d*(this.bezc1y),a+d*(this.bezc2x),f+d*(this.bezc2y),a+d*(this.bezex),f+d*(this.bezey));context.stroke()}if(this.should_highlight2()){context.strokeStyle=this.highlightcolor2();context.lineWidth=d*(this.bezr)*b;context.beginPath();context.moveTo(a+d*(this.bezsx),f+d*this.bezsy);context.bezierCurveTo(a+d*(this.bezc1x),f+d*(this.bezc1y),a+d*(this.bezc2x),f+d*(this.bezc2y),a+d*(this.bezex),f+d*(this.bezey));context.stroke()}}};midnode.prototype.drawInternal=function(){var a;var d;var b;if(this.rvar){a=this.xvar;d=this.yvar;b=this.rvar}var c=false;if(this.should_highlight1()||this.should_highlight2()){c=true}if(c){context.beginPath();context.arc(a+b*(this.arcx),d+b*this.arcy,b*this.arcr,0,Math.PI*2,true);context.fillStyle=this.branchcolor();context.fill()}if((this.npolyt)||(polytype==3)){if(b>thresholdtxt*50){this.drawInternalCircle(a+b*(this.arcx),d+b*this.arcy,b*this.arcr,c);if(b>thresholdtxt*280){this.drawInternalTextDetail(a+b*(this.arcx),d+b*this.arcy,b*this.arcr*(1-partl2))}else{this.drawInternalTextRough(a+b*(this.arcx),d+b*this.arcy,b*this.arcr*(1-partl2))}}else{if((c)&&((b*this.arcr*2)>3)){this.drawInternalHighlight(a+b*(this.arcx),d+b*this.arcy,b*this.arcr,this.arca)}}}else{if(c){this.drawInternalHighlight(a+b*(this.arcx),d+b*this.arcy,b*this.arcr,this.arca)}if(polytype==1){context.beginPath();context.arc(a+b*(this.arcx),d+b*this.arcy,b*this.arcr,0,Math.PI*2,true);context.fillStyle=this.barccolor();context.fill()}}};midnode.prototype.drawInternalCircle=function(a,d,c,b){context.beginPath();context.arc(a,d,c*(1-partl2/2),0,Math.PI*2,true);context.lineWidth=c*partl2;if(b){if(this.should_highlight1()){context.strokeStyle=this.highlightcolor()}else{context.strokeStyle=this.highlightcolor2()}}else{context.strokeStyle=this.barccolor()}context.stroke();if(b&&(this.should_highlight1()&&this.should_highlight2())){context.beginPath();context.arc(a,d,c*(1-partl2*0.75),0,Math.PI*2,true);
context.lineWidth=c*partl2/2;context.strokeStyle=this.highlightcolor2();context.stroke()}};midnode.prototype.drawInternalHighlight=function(a,h,e,g){if(int_highlight_type==2){var c=Math.sin(g);var d=Math.cos(g);var b=Math.sin(g+Math.PI/2);var f=Math.cos(g+Math.PI/2);context.beginPath();context.lineTo(a+0.4*e*d,h+0.4*e*c);context.lineTo(a-1*e*d+0.7*e*f,h-1*e*c+0.7*e*b);context.lineTo(a-1*e*d-0.7*e*f,h-1*e*c-0.7*e*b);context.lineTo(a+0.4*e*d,h+0.4*e*c);context.fillStyle=this.branchcolor();context.fill();if(this.should_highlight1()){context.fillStyle=this.highlightcolor()}else{context.fillStyle=this.highlightcolor2()}context.fill();if(this.should_highlight1()&&this.should_highlight2()){context.beginPath();context.lineTo(a+0.17*e*d,h+0.17*e*c);context.lineTo(a-1*e*d+0.55*e*f,h-1*e*c+0.55*e*b);context.lineTo(a-1*e*d-0.55*e*f,h-1*e*c-0.55*e*b);context.lineTo(a+0.17*e*d,h+0.17*e*c);context.fillStyle=this.highlightcolor2();context.fill()}}else{context.beginPath();context.arc(a,h,e*0.5,0,Math.PI*2,true);if(this.should_highlight1()){context.fillStyle=this.highlightcolor()}else{context.fillStyle=this.highlightcolor2()}context.fill();if(this.should_highlight1()&&this.should_highlight2()){context.beginPath();context.arc(a,h,e*0.25,0,Math.PI*2,true);context.fillStyle=this.highlightcolor2();context.fill()}}};midnode.prototype.fakeleaflogic=function(a,d,b,c){context.strokeStyle=this.leafcolor2();context.fillStyle=this.leafcolor1();if(leaftype==1){drawleaf1(a,d,b)}else{drawleaf2(a,d,b,c)}};midnode.prototype.growthleaflogic=function(a,d,b,c){context.strokeStyle=this.leafcolor2();context.fillStyle=this.leafcolor1();if(leaftype==1){drawleaf1(a,d,b)}else{drawleaf2(a,d,b,c)}};midnode.prototype.tipleaflogic=function(a,d,b,c){context.strokeStyle=this.leafcolor2();context.fillStyle=this.leafcolor1();if(leaftype==1){drawleaf1(a,d,b)}else{drawleaf2(a,d,b,c)}};function drawleaf1(a,c,b){context.beginPath();context.arc(a,c,b*(1-partl2*1.5),0,Math.PI*2,true);context.lineWidth=b*(partl2*3);context.stroke();context.fill()}function drawleaf2(n,m,b,e){var d=Math.sin(e);var l=Math.cos(e);var h=Math.sin(e+Math.PI/2);var o=Math.cos(e+Math.PI/2);var c=n-b*(1-0.1*1)*l;var k=n+b*(1-0.1*1)*l;var a=m-b*(1-0.1*1)*d;var j=m+b*(1-0.1*1)*d;var f=(j-a)/3;var g=(k-c)/3;context.beginPath();context.moveTo(c,a);context.bezierCurveTo(c+g+2*b/2.4*o,a+f+2*b/2.4*h,c+2*g+2*b/2.4*o,a+2*f+2*b/2.4*h,k,j);context.bezierCurveTo(c+2*g-2*b/2.4*o,a+2*f-2*b/2.4*h,c+g-2*b/2.4*o,a+f-2*b/2.4*h,c,a);context.lineWidth=b*(0.1*3);context.stroke();context.fill()}midnode.prototype.should_draw_link=function(b){var c=true;if(this.child1){if(linkSet.node[b][0]!=(-2)){c=false;var a=metadata.node_meta[0];if((linkSet.node[b][0]<a.length)&&(linkSet.node[b][0]>=0)){if(metadata.node_meta[this.metacode][linkSet.node[b][0]]){c=true}}if(linkSet.node[b][0]==-1){if(this.name1){c=true}}}}else{if(linkSet.leaf[b][0]!=(-2)){c=false;var a=metadata.leaf_meta[0];if((linkSet.leaf[b][0]<a.length)&&(linkSet.leaf[b][0]>=0)){if(metadata.leaf_meta[this.metacode][linkSet.leaf[b][metadata_cnp_leaf-1]]){c=true}}}if(linkSet.leaf[b][0]==-1){if((this.name1)&&(this.name2)){c=true}}}return(c)};midnode.prototype.draw_link=function(a,f,d,c,b){var e=false;if(d>10){if((((mouseX-a)*(mouseX-a))+((mouseY-f)*(mouseY-f)))<=(d*d)){if((!mousehold)&&(!justopened_url)){e=true}}if(e){context.fillStyle=link_highlight_color}else{context.fillStyle=link_background_color}context.beginPath();context.arc(a,f,d,0,Math.PI*2,true);context.fill();if(e){context.fillStyle=link_background_color}else{context.fillStyle=b}context.beginPath();context.arc(a,f,d*0.833,0,Math.PI*2,true);context.fill();if(e){context.fillStyle=link_highlight_color}else{context.fillStyle=link_background_color}if(this.child1){autotext3(true,linkSet.node[c][2],a,f,d*1.1,d*0.4)}else{autotext3(true,linkSet.leaf[c][2],a,f,d*1.1,d*0.4)}if(e){if(this.child1){mouse_on_url=this.Link_convertor(linkSet.node[c][3]);mouse_on_url_new=linkSet.node[c][1]}else{mouse_on_url=this.Link_convertor(linkSet.leaf[c][3]);mouse_on_url_new=linkSet.leaf[c][1]}if(mouse_on_url){mouse_on_url_valid=true}}}else{context.fillStyle=link_background_color;context.beginPath();context.arc(a,f,d,0,Math.PI*2,true);context.fill()}return e};midnode.prototype.Link_convertor=function(c){var b=c.split("||");var a="";for(i=0;i<b.length;i++){a+=this.Link_mapper(b[i])}return(a)};midnode.prototype.Link_mapper=function(b){var a=false;if(this.child1){if(b=="name"){if(this.name1){a=true;return(this.name1.toLowerCase())}}if(!a){var c=metadata.node_meta[0];for(jj=0;jj<(c).length;jj++){if(b==metadata.node_meta[0][jj]){a=true;return((metadata.node_meta[this.metacode][jj]).toString())}}}}else{if(b=="genus"){if(this.name2){a=true;return(this.name2.toLowerCase())}}else{if(b=="species"){if(this.name1){a=true;return(this.name1.toLowerCase())}}}if(!a){var c=metadata.leaf_meta[0];for(jj=0;jj<c.length;jj++){if(b==metadata.leaf_meta[0][jj]){a=true;return((metadata.leaf_meta[this.metacode][jj]).toString())}}}}if(!a){return(b)}};midnode.prototype.drawLinkSet=function(g,f,a,h){var j=0;
if(this.child1){for(b=0;b<linkSet.node.length;b++){if(b!=(node_link_priority-1)){if(this.should_draw_link(b)){j++}}}}else{for(b=0;b<linkSet.leaf.length;b++){if(b!=(leaf_link_priority-1)){if(this.should_draw_link(b)){j++}}}}var c=0;var d=0;var e=a;if(this.child1){if(node_link_priority){if(this.should_draw_link((node_link_priority-1))){d=1.5}}if((e*2*(j+d))>h){e=h/(j+d)/2}var b=0;while((c)<((j/2)-0.1)){if(b!=(node_link_priority-1)){if(this.should_draw_link(b)){this.draw_link(g-h/2+(c+0.5)*(h/(j+d)),f,e,b,this.branchcolor());c++}}b++}if(node_link_priority){if(this.should_draw_link((node_link_priority-1))){this.draw_link(g-h/2+(c+0.5*d)*(h/(j+d)),f-(e*0.4),e*1.4,(node_link_priority-1),this.branchcolor());c+=d}}while((c)<(j+d)){if(b!=(node_link_priority-1)){if(this.should_draw_link(b)){this.draw_link(g-h/2+(c+0.5)*(h/(j+d)),f,e,b,this.branchcolor());c++}}b++}}else{if(leaf_link_priority){if(this.should_draw_link((leaf_link_priority-1))){d=1.5}}if((e*2*(j+d))>h){e=h/(j+d)/2}var b=0;while((c)<((j/2)-0.1)){if(b!=(leaf_link_priority-1)){if(this.should_draw_link(b)){this.draw_link(g-h/2+(c+0.5)*(h/(j+d)),f,e,b,this.leafcolor2());c++}}b++}if(leaf_link_priority){if(this.should_draw_link((leaf_link_priority-1))){this.draw_link(g-h/2+(c+0.5*d)*(h/(j+d)),f-(e*0.4),e*1.4,(leaf_link_priority-1),this.leafcolor2());c+=d}}while((c)<(j+d)){if(b!=(leaf_link_priority-1)){if(this.should_draw_link(b)){this.draw_link(g-h/2+(c+0.5)*(h/(j+d)),f,e,b,this.leafcolor2());c++}}b++}}};drawPieSlice=function(a,h,e,g,f,b,d){if(f>0){var c=g+(f/d)*Math.PI*2;context.fillStyle=b;context.beginPath();context.moveTo(a,h);context.arc(a,h,e,g,c,false);context.fill()}};drawPie=function(a,g,e,c,d,b){var f=-c[c.length-1]/b;drawPieSlice(a,g,e*(1-pieborder/2),f,c[0]+c[1]+c[c.length-1],d[0],b);f=(c[0]/b)*Math.PI*2;for(i=1;i<c.length-1;i++){drawPieSlice(a,g,e*(1-pieborder/2),f,c[i]+c[i+1]/2,d[i],b);f=f+(c[i]/b)*Math.PI*2}drawPieSlice(a,g,e*(1-pieborder/2),f,c[c.length-1],d[c.length-1],b);context.strokeStyle=pie_background_color;context.lineWidth=e*pieborder;context.beginPath();context.arc(a,g,e*(1-pieborder/2),0,Math.PI*2,true);context.stroke()};drawPieKey=function(h,g,a,j,d,c,b,l,k,f,e,m){for(i=0;i<c.length;i++){context.fillStyle=pie_background_color;context.beginPath();context.arc(h-j/2+(i+0.5)*(j/c.length),g,a,0,Math.PI*2,true);context.fill();context.fillStyle=c[i];context.beginPath();context.arc(h-j/2+(i+0.5)*(j/c.length),g,a*(1-pieborder),0,Math.PI*2,true);context.fill();context.fillStyle=e;autotext(false,f[i],h-j/2+(i+0.5)*(j/c.length),g,a*(1-pieborder)*1.5,a*(1-pieborder)*0.8);if(l[i]){autotext(false,l[i],h-j/2+(i+0.5)*(j/c.length),g+a*(1-pieborder)*0.46,a*(1-pieborder)*1.5,a*(1-pieborder)*0.15)}if(k[i]){autotext(true,k[i],h-j/2+(i+0.5)*(j/c.length),g+a*(1-pieborder)*0.7,a*(1-pieborder)*0.95,a*(1-pieborder)*0.15)}autotext(false,(Math.round(10000*(d[i]/b))/100).toString()+" %",h-j/2+(i+0.5)*(j/c.length),g-a*(1-pieborder)*0.7,a*(1-pieborder)*0.95,a*(1-pieborder)*0.15);autotext(false,(d[i]).toString()+" "+m,h-j/2+(i+0.5)*(j/c.length),g-a*(1-pieborder)*0.46,a*(1-pieborder)*1.5,a*(1-pieborder)*0.15)}};var partl1=0.55;var leafmult=3.2;var posmult=leafmult-2;midnode.prototype.precalc=function(h,f,l,o){this.arca=o;var n=Math.sin(o);var b=Math.cos(o);var q=Math.sin(o+Math.PI/2);var m=Math.cos(o+Math.PI/2);var p;var s;if(this.child1){p=Math.atan2((this.child1).richness_val,(this.child2).richness_val);s=Math.atan2(Math.pow((this.child1).richness_val,0.5),Math.pow(((this.child2).richness_val),0.5))}var u=0.46;var a=0.22;var g=1/1.3;var e=1/2.25;var k=Math.sin(o+Math.PI*a);var d=Math.cos(o+Math.PI*a);var j=Math.sin(o-Math.PI*u);var c=Math.cos(o-Math.PI*u);if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.nextr1=g;this.nextr2=e;(this.child1).bezsx=-(0.3)*(b)/g;(this.child1).bezsy=-(0.3)*(n)/g;(this.child1).bezex=d;(this.child1).bezey=k;(this.child1).bezc1x=-0.3*(b)/g;(this.child1).bezc1y=-0.3*(n)/g;(this.child1).bezc2x=0.15*(b)/g;(this.child1).bezc2y=0.15*(n)/g;(this.child1).bezr=partl1;(this.child2).bezsx=-(0.3)*(b)/e;(this.child2).bezsy=-(0.3)*(n)/e;(this.child2).bezex=c;(this.child2).bezey=j;(this.child2).bezc1x=0.1*(b)/e;(this.child2).bezc1y=0.1*(n)/e;(this.child2).bezc2x=0.9*c;(this.child2).bezc2y=0.9*j;(this.child2).bezr=partl1;this.nextx1=(1.3*Math.cos(o))+(((this.bezr)-(partl1*g))/2)*m;this.nexty1=(1.3*Math.sin(o))+(((this.bezr)-(partl1*g))/2)*q;this.nextx2=(1.3*Math.cos(o))-(((this.bezr)-(partl1*e))/2)*m;this.nexty2=(1.3*Math.sin(o))-(((this.bezr)-(partl1*e))/2)*q}else{this.nextr2=g;this.nextr1=e;(this.child2).bezsx=-(0.3)*(b)/g;(this.child2).bezsy=-(0.3)*(n)/g;(this.child2).bezex=d;(this.child2).bezey=k;(this.child2).bezc1x=-0.2*(b)/g;(this.child2).bezc1y=-0.2*(n)/g;(this.child2).bezc2x=0.15*(b)/g;(this.child2).bezc2y=0.15*(n)/g;(this.child2).bezr=partl1;(this.child1).bezsx=-(0.3)*(b)/e;(this.child1).bezsy=-(0.3)*(n)/e;(this.child1).bezex=c;(this.child1).bezey=j;(this.child1).bezc1x=0.1*(b)/e;(this.child1).bezc1y=0.1*(n)/e;(this.child1).bezc2x=0.9*c;
(this.child1).bezc2y=0.9*j;(this.child1).bezr=partl1;this.nextx2=(1.3*Math.cos(o))+(((this.bezr)-(partl1*g))/2)*m;this.nexty2=(1.3*Math.sin(o))+(((this.bezr)-(partl1*g))/2)*q;this.nextx1=(1.3*Math.cos(o))-(((this.bezr)-(partl1*e))/2)*m;this.nexty1=(1.3*Math.sin(o))-(((this.bezr)-(partl1*e))/2)*q}this.arcx=this.bezex;this.arcy=this.bezey;this.arcr=(this.bezr)/2;if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.child1.precalc(h+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*g,o+Math.PI*a);this.child2.precalc(h+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*e,o-Math.PI*u)}else{this.child2.precalc(h+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*g,o+Math.PI*a);this.child1.precalc(h+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*e,o-Math.PI*u)}}}else{this.arcx=this.bezex+posmult*(b);this.arcy=this.bezey+posmult*(n);this.arcr=leafmult*0.4*1}};midnode.prototype.precalc2=function(j,f,l,q){this.arca=q;var n=Math.sin(q);var b=Math.cos(q);var u=Math.sin(q+Math.PI/2);var m=Math.cos(q+Math.PI/2);var s;var v;if(this.child1){s=Math.atan2((this.child1).richness_val,(this.child2).richness_val);v=Math.atan2(Math.pow((this.child1).richness_val,0.5),Math.pow(((this.child2).richness_val),0.5))}var w=0.5;var a=0.2;var g=0.77;var e=0.47;var p;var o;if((this.richness_val>1)&&((this.child1)&&(this.child2))){if((this.child1.richness_val)>=(this.child2.richness_val)){a=0.45-(s)/Math.PI/0.5*0.449;w=0.45-(0.5-(s)/Math.PI)/0.5*0.449;g=0.3+(v)/Math.PI/0.5*0.5;e=0.3+(0.5-(v)/Math.PI)/0.5*0.5}else{w=0.45-(s)/Math.PI/0.5*0.449;a=0.45-(0.5-(s)/Math.PI)/0.5*0.449;e=0.3+(v)/Math.PI/0.5*0.5;g=0.3+(0.5-(v)/Math.PI)/0.5*0.5}}if(this.child1){p=(this.child1.richness_val)/((this.child1.richness_val)+(this.child2.richness_val));o=(this.child2.richness_val)/((this.child1.richness_val)+(this.child2.richness_val))}var k=Math.sin(q+Math.PI*a);var d=Math.cos(q+Math.PI*a);var h=Math.sin(q-Math.PI*w);var c=Math.cos(q-Math.PI*w);if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.nextr1=g;this.nextr2=e;(this.child1).bezsx=-(0.3)*(b)/g;(this.child1).bezsy=-(0.3)*(n)/g;(this.child1).bezex=d;(this.child1).bezey=k;(this.child1).bezc1x=0;(this.child1).bezc1y=0;(this.child1).bezc2x=0.9*d;(this.child1).bezc2y=0.9*k;(this.child1).bezr=partl1;(this.child2).bezsx=-(0.3)*(b)/e;(this.child2).bezsy=-(0.3)*(n)/e;(this.child2).bezex=c;(this.child2).bezey=h;(this.child2).bezc1x=0;(this.child2).bezc1y=0;(this.child2).bezc2x=0.3*c;(this.child2).bezc2y=0.3*h;(this.child2).bezr=partl1;this.nextx1=(1.3*Math.cos(q))+(((this.bezr)-(partl1*g))/2)*m;this.nexty1=(1.3*Math.sin(q))+(((this.bezr)-(partl1*g))/2)*u;this.nextx2=(1.3*Math.cos(q))-(((this.bezr)-(partl1*e))/2)*m;this.nexty2=(1.3*Math.sin(q))-(((this.bezr)-(partl1*e))/2)*u}else{this.nextr2=g;this.nextr1=e;(this.child2).bezsx=-(0.3)*(b)/g;(this.child2).bezsy=-(0.3)*(n)/g;(this.child2).bezex=d;(this.child2).bezey=k;(this.child2).bezc1x=0;(this.child2).bezc1y=0;(this.child2).bezc2x=0.9*d;(this.child2).bezc2y=0.9*k;(this.child2).bezr=partl1;(this.child1).bezsx=-(0.3)*(b)/e;(this.child1).bezsy=-(0.3)*(n)/e;(this.child1).bezex=c;(this.child1).bezey=h;(this.child1).bezc1x=0;(this.child1).bezc1y=0;(this.child1).bezc2x=0.9*c;(this.child1).bezc2y=0.9*h;(this.child1).bezr=partl1;this.nextx2=(1.3*Math.cos(q))+(((this.bezr)-(partl1*g))/2)*m;this.nexty2=(1.3*Math.sin(q))+(((this.bezr)-(partl1*g))/2)*u;this.nextx1=(1.3*Math.cos(q))-(((this.bezr)-(partl1*e))/2)*m;this.nexty1=(1.3*Math.sin(q))-(((this.bezr)-(partl1*e))/2)*u}this.arcx=this.bezex;this.arcy=this.bezey;this.arcr=(this.bezr)/2;if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.child1.precalc2(j+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*g,q+Math.PI*a);this.child2.precalc2(j+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*e,q-Math.PI*w)}else{this.child2.precalc2(j+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*g,q+Math.PI*a);this.child1.precalc2(j+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*e,q-Math.PI*w)}}}else{this.arcx=this.bezex+posmult*(b);this.arcy=this.bezey+posmult*(n);this.arcr=leafmult*0.4}};midnode.prototype.precalc4=function(h,f,l,o){this.arca=o;var n=Math.sin(o);var b=Math.cos(o);var q=Math.sin(o+Math.PI/2);var m=Math.cos(o+Math.PI/2);var p;var s;if(this.child1){p=Math.atan2((this.child1).richness_val,(this.child2).richness_val);s=Math.atan2(Math.pow((this.child1).richness_val,0.5),Math.pow(((this.child2).richness_val),0.5))}var u=0.33;var a=0.33;var g=0.61;var e=0.61;var k=Math.sin(o+Math.PI*a);var d=Math.cos(o+Math.PI*a);var j=Math.sin(o-Math.PI*u);var c=Math.cos(o-Math.PI*u);if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.nextr1=g;this.nextr2=e;(this.child1).bezsx=-(0.3)*(b)/g;(this.child1).bezsy=-(0.3)*(n)/g;(this.child1).bezex=d;(this.child1).bezey=k;(this.child1).bezc1x=-0.3*(b)/g;(this.child1).bezc1y=-0.3*(n)/g;(this.child1).bezc2x=0.15*(b)/g;(this.child1).bezc2y=0.15*(n)/g;(this.child1).bezr=partl1;(this.child2).bezsx=-(0.3)*(b)/e;(this.child2).bezsy=-(0.3)*(n)/e;(this.child2).bezex=c;
(this.child2).bezey=j;(this.child2).bezc1x=0.1*(b)/e;(this.child2).bezc1y=0.1*(n)/e;(this.child2).bezc2x=0.9*c;(this.child2).bezc2y=0.9*j;(this.child2).bezr=partl1;this.nextx1=(1.3*Math.cos(o))+(((this.bezr)-(partl1*g))/2)*m;this.nexty1=(1.3*Math.sin(o))+(((this.bezr)-(partl1*g))/2)*q;this.nextx2=(1.3*Math.cos(o))-(((this.bezr)-(partl1*e))/2)*m;this.nexty2=(1.3*Math.sin(o))-(((this.bezr)-(partl1*e))/2)*q}else{this.nextr2=g;this.nextr1=e;(this.child2).bezsx=-(0.3)*(b)/g;(this.child2).bezsy=-(0.3)*(n)/g;(this.child2).bezex=d;(this.child2).bezey=k;(this.child2).bezc1x=-0.2*(b)/g;(this.child2).bezc1y=-0.2*(n)/g;(this.child2).bezc2x=0.15*(b)/g;(this.child2).bezc2y=0.15*(n)/g;(this.child2).bezr=partl1;(this.child1).bezsx=-(0.3)*(b)/e;(this.child1).bezsy=-(0.3)*(n)/e;(this.child1).bezex=c;(this.child1).bezey=j;(this.child1).bezc1x=0.1*(b)/e;(this.child1).bezc1y=0.1*(n)/e;(this.child1).bezc2x=0.9*c;(this.child1).bezc2y=0.9*j;(this.child1).bezr=partl1;this.nextx2=(1.3*Math.cos(o))+(((this.bezr)-(partl1*g))/2)*m;this.nexty2=(1.3*Math.sin(o))+(((this.bezr)-(partl1*g))/2)*q;this.nextx1=(1.3*Math.cos(o))-(((this.bezr)-(partl1*e))/2)*m;this.nexty1=(1.3*Math.sin(o))-(((this.bezr)-(partl1*e))/2)*q}this.arcx=this.bezex;this.arcy=this.bezey;this.arcr=(this.bezr)/2;if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){this.child1.precalc4(h+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*g,o+Math.PI*a);this.child2.precalc4(h+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*e,o-Math.PI*u)}else{this.child2.precalc4(h+((l)*(this.nextx2)),f+(l)*(this.nexty2),l*g,o+Math.PI*a);this.child1.precalc4(h+((l)*(this.nextx1)),f+(l)*(this.nexty1),l*e,o-Math.PI*u)}}}else{this.arcx=this.bezex+posmult*(b);this.arcy=this.bezey+posmult*(n);this.arcr=leafmult*0.4}};midnode.prototype.precalc3=function(j,f,m,u,o){this.arca=u;var q=Math.sin(u);var b=Math.cos(u);var w=Math.sin(u+Math.PI/2);var p=Math.cos(u+Math.PI/2);var v;var z;var A=0.2;var a=0.1;var g=0.85;var e=0.42;var s=false;if(!o){var A=0.1;var a=0.2;var g=0.42;var e=0.85;if(this.child1){if((this.child1.richness_val)<(this.child2.richness_val)){s=true}}}else{if(this.child1){if((this.child1.richness_val)>=(this.child2.richness_val)){s=true}}}var n=partl1;var l=partl1;var k=Math.sin(u+Math.PI*a);var d=Math.cos(u+Math.PI*a);var h=Math.sin(u-Math.PI*A);var c=Math.cos(u-Math.PI*A);if(this.child1){if(s){this.nextr1=g;this.nextr2=e;(this.child1).bezsx=-(0.3)*(b)/g;(this.child1).bezsy=-(0.3)*(q)/g;(this.child1).bezex=d;(this.child1).bezey=k;(this.child1).bezc1x=-0.3*(b)/g;(this.child1).bezc1y=-0.3*(q)/g;(this.child1).bezc2x=0.15*(b)/g;(this.child1).bezc2y=0.15*(q)/g;(this.child1).bezr=partl1;(this.child2).bezsx=-(0.3)*(b)/e;(this.child2).bezsy=-(0.3)*(q)/e;(this.child2).bezex=c;(this.child2).bezey=h;(this.child2).bezc1x=0.1*(b)/e;(this.child2).bezc1y=0.1*(q)/e;(this.child2).bezc2x=0.9*c;(this.child2).bezc2y=0.9*h;(this.child2).bezr=partl1;this.nextx1=(1.3*Math.cos(u))+(((this.bezr)-(n*g))/2)*p;this.nexty1=(1.3*Math.sin(u))+(((this.bezr)-(n*g))/2)*w;this.nextx2=(1.3*Math.cos(u))-(((this.bezr)-(l*e))/2)*p;this.nexty2=(1.3*Math.sin(u))-(((this.bezr)-(l*e))/2)*w}else{this.nextr2=g;this.nextr1=e;(this.child2).bezsx=-(0.3)*(b)/g;(this.child2).bezsy=-(0.3)*(q)/g;(this.child2).bezex=d;(this.child2).bezey=k;(this.child2).bezc1x=-0.2*(b)/g;(this.child2).bezc1y=-0.2*(q)/g;(this.child2).bezc2x=0.15*(b)/g;(this.child2).bezc2y=0.15*(q)/g;(this.child2).bezr=partl1;(this.child1).bezsx=-(0.3)*(b)/e;(this.child1).bezsy=-(0.3)*(q)/e;(this.child1).bezex=c;(this.child1).bezey=h;(this.child1).bezc1x=0.1*(b)/e;(this.child1).bezc1y=0.1*(q)/e;(this.child1).bezc2x=0.9*c;(this.child1).bezc2y=0.9*h;(this.child1).bezr=partl1;this.nextx2=(1.3*Math.cos(u))+(((this.bezr)-(n*g))/2)*p;this.nexty2=(1.3*Math.sin(u))+(((this.bezr)-(n*g))/2)*w;this.nextx1=(1.3*Math.cos(u))-(((this.bezr)-(l*e))/2)*p;this.nexty1=(1.3*Math.sin(u))-(((this.bezr)-(l*e))/2)*w}this.arcx=this.bezex;this.arcy=this.bezey;this.arcr=(this.bezr)/2;if(this.child1){if(s){this.child1.precalc3(j+((m)*(this.nextx1)),f+(m)*(this.nexty1),m*g,u+Math.PI*a,!o);this.child2.precalc3(j+((m)*(this.nextx2)),f+(m)*(this.nexty2),m*e,u-Math.PI*A,!o)}else{this.child2.precalc3(j+((m)*(this.nextx2)),f+(m)*(this.nexty2),m*g,u+Math.PI*a,!o);this.child1.precalc3(j+((m)*(this.nextx1)),f+(m)*(this.nexty1),m*e,u-Math.PI*A,!o)}}}else{this.arcx=this.bezex+posmult*0.9*(b);this.arcy=this.bezey+posmult*0.9*(q);this.arcr=leafmult*0.4*0.9}};function update_form(){fulltree.drawreg(xp,yp,220*ws);fulltree.move2();fulltree.bezsx=0;fulltree.bezsy=0;fulltree.bezex=0;fulltree.bezey=-1;fulltree.bezc1x=0;fulltree.bezc1y=-0.05;fulltree.bezc2x=0;fulltree.bezc2y=-0.95;fulltree.bezr=partl1;if(viewtype==2){fulltree.precalc2(xp,yp,220*ws,Math.PI*3/2)}else{if(viewtype==3){fulltree.bezsx=-Math.sin(Math.PI*0.05);fulltree.bezsy=0;fulltree.bezex=-Math.sin(Math.PI*0.05);fulltree.bezey=-Math.cos(Math.PI*0.05);fulltree.bezc1x=-Math.sin(Math.PI*0.05);fulltree.bezc1y=-0.05;fulltree.bezc2x=-Math.sin(Math.PI*0.05);fulltree.bezc2y=-0.95;
fulltree.bezr=partl1;fulltree.precalc3(xp,yp,220*ws,Math.PI*(3/2-0.05),true,true)}else{if(viewtype==4){fulltree.precalc4(xp,yp,220*ws,Math.PI*3/2)}else{fulltree.precalc(xp,yp,220*ws,Math.PI*3/2)}}}fulltree.calchorizon();fulltree.graphref=true;fulltree.reref();Resize_only();fulltree.deanchor();fulltree.reref();fulltree.move3(40,widthres-40,40,heightres-40);draw2()}midnode.prototype.richness_calc=function(){if(this.child1){this.richness_val=(((this.child1).richness_calc())+((this.child2).richness_calc()))}else{if(this.richness_val<=0){this.richness_val=1}}return(this.richness_val)};midnode.prototype.name_calc=function(){if(this.child1){if(((this.child1).name_calc())==((this.child2).name_calc())){this.name2=((this.child1).name2)}}return(this.name2)};midnode.prototype.phylogeneticdiv_calc=function(){this.phylogenetic_diversity=0;if(this.child1){this.phylogenetic_diversity+=(this.child2).phylogeneticdiv_calc();this.phylogenetic_diversity+=(this.child1).phylogeneticdiv_calc()}return(this.phylogenetic_diversity+this.lengthbr)};midnode.prototype.age_calc=function(){if((this.lengthbr==0)&&(this.child1)){this.npolyt=false}else{this.npolyt=true}var a;a=(this.lengthbr);if(this.child1){(this.lengthbr)=(this.child2).age_calc();(this.lengthbr)=(this.child1).age_calc();return((a)+(this.lengthbr))}else{(this.lengthbr)=0;return(a)}};midnode.prototype.inlabel_calc=function(a){if(this.child1){if((this.name2)&&(this.name2!=a)){this.name1=this.name2;this.child1.inlabel_calc(this.name1);this.child2.inlabel_calc(this.name1)}else{this.name2=null;this.child1.inlabel_calc(a);this.child2.inlabel_calc(a)}}};midnode.prototype.mult=function(){var a;if(this.child1){if(this.child1.graphref){a=(this.nextr1)*(this.child1.mult())}else{if(this.child2.graphref){a=(this.nextr2)*(this.child2.mult())}else{a=1}}}else{a=1}return a};midnode.prototype.reref=function(){if(this.onroute){this.graphref=true;if(this.child1){if(this.child1.onroute){this.child1.reref()}else{this.child1.graphref=false}if(this.child2.onroute){this.child2.reref()}else{this.child2.graphref=false}}}};midnode.prototype.calchorizon=function(){this.hxmax=this.bezsx;this.hxmin=this.bezsx;this.hymax=this.bezsy;this.hymin=this.bezsy;if(this.hxmax<this.bezc1x){this.hxmax=this.bezc1x}if(this.hxmin>this.bezc1x){this.hxmin=this.bezc1x}if(this.hymax<this.bezc1y){this.hymax=this.bezc1y}if(this.hymin>this.bezc1y){this.hymin=this.bezc1y}if(this.hxmax<this.bezc2x){this.hxmax=this.bezc2x}if(this.hxmin>this.bezc2x){this.hxmin=this.bezc2x}if(this.hymax<this.bezc2y){this.hymax=this.bezc2y}if(this.hymin>this.bezc2y){this.hymin=this.bezc2y}if(this.hxmax<this.bezex){this.hxmax=this.bezex}if(this.hxmin>this.bezex){this.hxmin=this.bezex}if(this.hymax<this.bezey){this.hymax=this.bezey}if(this.hymin>this.bezey){this.hymin=this.bezey}this.hxmax+=this.bezr/2;this.hxmin-=this.bezr/2;this.hymax+=this.bezr/2;this.hymin-=this.bezr/2;if(this.hxmax<(this.arcx+this.arcr)){this.hxmax=(this.arcx+this.arcr)}if(this.hxmin>(this.arcx-this.arcr)){this.hxmin=(this.arcx-this.arcr)}if(this.hymax<(this.arcy+this.arcr)){this.hymax=(this.arcy+this.arcr)}if(this.hymin>(this.arcy-this.arcr)){this.hymin=(this.arcy-this.arcr)}this.gxmax=this.hxmax;this.gxmin=this.hxmin;this.gymax=this.hymax;this.gymin=this.hymin;if(this.child1){this.child1.calchorizon();this.child2.calchorizon();if(this.hxmax<(this.nextx1+this.nextr1*this.child1.hxmax)){this.hxmax=(this.nextx1+this.nextr1*this.child1.hxmax)}if(this.hxmin>(this.nextx1+this.nextr1*this.child1.hxmin)){this.hxmin=(this.nextx1+this.nextr1*this.child1.hxmin)}if(this.hymax<(this.nexty1+this.nextr1*this.child1.hymax)){this.hymax=(this.nexty1+this.nextr1*this.child1.hymax)}if(this.hymin>(this.nexty1+this.nextr1*this.child1.hymin)){this.hymin=(this.nexty1+this.nextr1*this.child1.hymin)}if(this.hxmax<(this.nextx2+this.nextr2*this.child2.hxmax)){this.hxmax=(this.nextx2+this.nextr2*this.child2.hxmax)}if(this.hxmin>(this.nextx2+this.nextr2*this.child2.hxmin)){this.hxmin=(this.nextx2+this.nextr2*this.child2.hxmin)}if(this.hymax<(this.nexty2+this.nextr2*this.child2.hymax)){this.hymax=(this.nexty2+this.nextr2*this.child2.hymax)}if(this.hymin>(this.nexty2+this.nextr2*this.child2.hymin)){this.hymin=(this.nexty2+this.nextr2*this.child2.hymin)}}};midnode.prototype.reanchor=function(){if(this.dvar){this.graphref=true;if(((this.gvar)||(!(this.child1)))||((this.rvar/220>0.01)&&(this.rvar/220<100))){xp=this.xvar;yp=this.yvar;ws=this.rvar/220;if(this.child1){this.child2.deanchor();this.child1.deanchor()}}else{if(this.child1.dvar){this.child1.reanchor();this.child2.deanchor()}else{this.child2.reanchor();this.child1.deanchor()}}}};midnode.prototype.deanchor=function(){if(this.graphref){if(this.child1){this.child1.deanchor();this.child2.deanchor()}this.graphref=false}};midnode.prototype.drawreg=function(a,c,b){if(this.child1){if(this.child1.graphref){this.child1.drawreg(a,c,b);this.rvar=this.child1.rvar/this.nextr1;this.xvar=this.child1.xvar-this.rvar*this.nextx1;this.yvar=this.child1.yvar-this.rvar*this.nexty1;
this.dvar=false;this.child2.gvar=false;this.child2.dvar=false;if(((!((((this.xvar+(this.rvar*this.hxmax))<0)||((this.xvar+(this.rvar*this.hxmin))>widthres))||(((this.yvar+(this.rvar*this.hymax))<0)||((this.yvar+(this.rvar*this.hymin))>heightres)))))){if(this.rvar>threshold){this.child2.drawreg2(this.xvar+((this.rvar)*(this.nextx2)),this.yvar+(this.rvar)*(this.nexty2),this.rvar*this.nextr2)}if(((((this.xvar+(this.rvar*this.gxmax))<0)||((this.xvar+(this.rvar*this.gxmin))>widthres))||(((this.yvar+(this.rvar*this.gymax))<0)||((this.yvar+(this.rvar*this.gymin))>heightres)))){this.gvar=false}else{this.gvar=true;this.dvar=true}if(this.rvar<=threshold){this.child1.gvar=false;this.child2.gvar=false;this.child1.dvar=false;this.child2.dvar=false}}else{this.gvar=false}if((this.child1.dvar)||(this.child2.dvar)){this.dvar=true}}else{if(this.child2.graphref){this.child2.drawreg(a,c,b);this.rvar=this.child2.rvar/this.nextr2;this.xvar=this.child2.xvar-this.rvar*this.nextx2;this.yvar=this.child2.yvar-this.rvar*this.nexty2;this.dvar=false;this.child1.gvar=false;this.child1.dvar=false;if(((!((((this.xvar+(this.rvar*this.hxmax))<0)||((this.xvar+(this.rvar*this.hxmin))>widthres))||(((this.yvar+(this.rvar*this.hymax))<0)||((this.yvar+(this.rvar*this.hymin))>heightres)))))){if(this.rvar>threshold){this.child1.drawreg2(this.xvar+((this.rvar)*(this.nextx1)),this.yvar+(this.rvar)*(this.nexty1),this.rvar*this.nextr1)}if(((((this.xvar+(this.rvar*this.gxmax))<0)||((this.xvar+(this.rvar*this.gxmin))>widthres))||(((this.yvar+(this.rvar*this.gymax))<0)||((this.yvar+(this.rvar*this.gymin))>heightres)))){this.gvar=false}else{this.gvar=true;this.dvar=true}if(this.rvar<=threshold){this.child1.gvar=false;this.child2.gvar=false;this.child1.dvar=false;this.child2.dvar=false}}else{this.gvar=false}if((this.child1.dvar)||(this.child2.dvar)){this.dvar=true}}else{this.drawreg2(a,c,b)}}}else{this.drawreg2(a,c,b)}};midnode.prototype.drawreg2=function(a,c,b){this.xvar=a;this.yvar=c;this.rvar=b;this.dvar=false;if(((!((((a+(b*this.hxmax))<0)||((a+(b*this.hxmin))>widthres))||(((c+(b*this.hymax))<0)||((c+(b*this.hymin))>heightres)))))){if(this.child1){if(b>threshold){this.child1.drawreg2(a+((b)*(this.nextx1)),c+(b)*(this.nexty1),b*this.nextr1);this.child2.drawreg2(a+((b)*(this.nextx2)),c+(b)*(this.nexty2),b*this.nextr2)}else{this.child1.gvar=false;this.child1.dvar=false;this.child2.gavr=false;this.child2.dvar=false}if((this.child1.dvar)||(this.child2.dvar)){this.dvar=true}}if(((((a+(b*this.gxmax))<0)||((a+(b*this.gxmin))>widthres))||(((c+(b*this.gymax))<0)||((c+(b*this.gymin))>heightres)))){this.gvar=false}else{this.gvar=true;this.dvar=true}}else{this.gvar=false}};midnode.prototype.oldest=function(){var c=0;if(this.dvar){if(this.gvar){if(this.lengthbr){if(this.lengthbr>c){c=this.lengthbr}}}if(this.child1){var b=this.child1.oldest();var a=this.child2.oldest();if(b>c){c=b}if(a>c){c=a}}}return c};function growstart(){timelim=fulltree.oldest();clearTimeout(t2);growingpause=true;growing=false;Resize()}function growrev(){if(timelim>=fulltree.oldest()){timelim=-0.001}clearTimeout(t2);growingpause=false;growing=true;Resize();timeinc=fulltree.lengthbr/(growthtimetot*10);grow3()}function growpause(){clearTimeout(t2);growingpause=true;growing=false;Resize()}function growplay(){if(timelim<=0){timelim=fulltree.oldest()}clearTimeout(t2);growingpause=false;growing=true;Resize();timeinc=fulltree.oldest()/(growthtimetot*10);grow2()}function growend(){clearTimeout(t2);timelim=-1;clearTimeout(t2);growingpause=false;growing=false;if(buttonoptions!=2){clearbuttons();reopenbuttons()}Resize()}function grow2(){if(timelim>=0){timelim-=timeinc;draw2();t2=setTimeout("grow2()",100)}else{clearTimeout(t2);draw2();t2=setTimeout("Resize()",500);growing=false;growingpause=false}}function grow3(){if(timelim<=fulltree.lengthbr){timelim+=timeinc;draw2();t2=setTimeout("grow3()",100)}else{clearTimeout(t2);draw2();t2=setTimeout("Resize()",500);growing=false;growingpause=true}}midnode.prototype.search=function(){this.startscore=0;this.targeted=false;this.searchinpast=0;this.flysofarA=false;this.flysofarB=false;var b=0;var c;if(this.child1){b+=(this.child1).search();b+=(this.child2).search()}if(b==0){var a=true;for(c=0;c<searchinparts.length;c++){if(!(this.searchone(searchinparts[c],false))){a=false}}if(a){b+=this.richness_val}}this.searchin=b;return b};midnode.prototype.search_URLinit=function(){this.targeted=false;var a=0;if(this.child1){var b=(this.child1).search_URLinit();var c=(this.child2).search_URLinit();if(b>0){if(c>0){this.targeted=true;a+=b;a+=c;this.child2.targeted=false;this.child1.targeted=false}else{this.targeted=true;a+=b}}else{if(c>0){this.targeted=true;a+=c}else{if(!(species_URL)){if((this.name1)&&((this.name1.toLowerCase())==(genus_URL))){a+=this.richness_val;this.targeted=true}else{if((this.name1)&&((this.name1.toLowerCase())==(taxa_URL))){a+=this.richness_val;this.targeted=true}}}}}}else{if((this.name2)&&((this.name2.toLowerCase())==(genus_URL))){if((this.name1)&&((this.name1.toLowerCase())==(species_URL))){a+=1;
this.targeted=true}else{if(!species_URL){a+=1;this.targeted=true}}}}this.searchin=a;return(a)};midnode.prototype.search_URLinit2=function(){var a=0;if(this.child1){var b=(this.child1).search_URLinit2();var c=(this.child2).search_URLinit2();if(b>0){if(c>0){this.targeted=true;a+=b;a+=c}else{this.targeted=true;a+=b}}else{if(c>0){this.targeted=true;a+=c}else{if((this.name1)&&((this.name1.toLowerCase())==(genus2_URL))){a+=this.richness_val;this.targeted=true}else{if((this.name1)&&((this.name1.toLowerCase())==(taxa2_URL))){a+=this.richness_val;this.targeted=true}}}}if(this.child2.targeted&&this.child1.targeted){this.child2.targeted=false;this.child1.targeted=false;this.targeted=true}}else{if((this.name2)&&((this.name2.toLowerCase())==(genus2_URL))){if((this.name1)&&((this.name1.toLowerCase())==(species2_URL))){a+=1;this.targeted=true}else{if(!species_URL){a+=1;this.targeted=true}}}}this.searchin2=a;return(a)};midnode.prototype.searchtarget=function(){var a=-1;if((this.searchin-this.searchinpast)>0){if(((this.searchin-this.searchinpast)/(this.richness_val))>0.7){this.targeted=true;if((this.child1)&&(((this.child1).searchin>0)||((this.child2).searchin>0))){if((((this.child1).searchin)-((this.child1).searchinpast))<=0){var c=(this.child2).searchtarget();a=c}else{if((((this.child2).searchin)-((this.child2).searchinpast))<=0){var c=(this.child1).searchtarget();a=c}else{a=this.searchin}}}else{a=this.searchin}}else{if(this.child1){var d=this.child1.searchtarget();var b=this.child2.searchtarget()}if(d>b){this.child1.targeted=true;this.child2.targeted=false;a=d}else{this.child2.targeted=true;this.child1.targeted=false;a=b}}}return(a)};midnode.prototype.searchtargetmark=function(){var a=-1;if(this.targeted){a=this.searchin;if(this.child1){if(this.child1.targeted){a=this.child1.searchtargetmark()}else{if(this.child2.targeted){a=this.child2.searchtargetmark()}}}this.searchinpast+=a}return(a)};midnode.prototype.clearsearch=function(){(this.searchin)=0;(this.searchin2)=0;this.targeted=false;this.searchinpast=0;this.flysofarA=false;this.flysofarB=false;if(this.child1){(this.child1).clearsearch();(this.child2).clearsearch()}};midnode.prototype.clearroute=function(){this.onroute=false;if(this.child1){(this.child1).clearroute();(this.child2).clearroute()}};midnode.prototype.semiclearsearch=function(){this.targeted=false;this.flysofarA=false;this.flysofarB=false;if(this.child1){(this.child1).semiclearsearch();(this.child2).semiclearsearch()}};function performsearch2(e){searchinteriornodes=false;var c=false;var b=document.forms.myform["tosearchfor"].value;b=search_substitutions(b);var a;var d=b.split(" ");if(d.length==searchinparts.length){for(a=0;a<d.length;a++){if(d[a]!=searchinparts[a]){c=true}}}else{c=true}if(latin_search!=(document.forms.myform["latinsearch"].checked)){c=true;latin_search=(document.forms.myform["latinsearch"].checked)}if(common_search!=(document.forms.myform["commonsearch"].checked)){c=true;common_search=(document.forms.myform["commonsearch"].checked)}if(trait_search!=(document.forms.myform["traitsearch"].checked)){c=true;trait_search=(document.forms.myform["traitsearch"].checked)}if(!c){if(e){fulltree.semiclearsearch()}c=false}else{fulltree.clearsearch();searchinparts=d;numhits=fulltree.search();c=true}return c}midnode.prototype.searchone=function(c,b){var a=0;if(document.forms.myform["traitsearch"].checked){if(this.dotraitsearch(c)==1){a+=this.richness_val}}if(a==0&&(document.forms.myform["latinsearch"].checked)){if((c.toLowerCase())==c){if(!((b)&&(this.child1))){if((this.name1)&&((this.name1.toLowerCase()).search(c)!=-1)){a+=this.richness_val}else{if(((this.name2)&&((this.name2.toLowerCase()).search(c)!=-1))&&(!this.child1)){a+=this.richness_val}}}}else{if(!((b)&&(this.child1))){if((this.name1)&&((this.name1).search(c)!=-1)){a+=this.richness_val}else{if(((this.name2)&&((this.name2).search(c)!=-1))&&(!this.child1)){a+=this.richness_val}}}}}if(a==0&&(document.forms.myform["commonsearch"].checked)){if(!((b)&&(this.child1))){if((c.toLowerCase())==c){if(this.child1){if((metadata.node_meta[this.metacode][metadata_cnp_node-1])&&((metadata.node_meta[this.metacode][metadata_cnp_node-1].toLowerCase()).search(c)!=-1)){a+=this.richness_val}}else{if((metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1])&&((metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1].toLowerCase()).search(c)!=-1)){a+=this.richness_val}}}else{if(this.child1){if((metadata.node_meta[this.metacode][metadata_cnp_node-1])&&((metadata.node_meta[this.metacode][metadata_cnp_node-1]).search(c)!=-1)){a+=this.richness_val}}else{if((metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1])&&((metadata.leaf_meta[this.metacode][metadata_cnp_leaf-1]).search(c)!=-1)){a+=this.richness_val}}}}}return a};function performleap(){clearTimeout(t);flying=false;if(fulltree.searchtarget()==-1){searchinparts=[];performsearch2(true);fulltree.searchtarget()}fulltree.targeted=true;fulltree.searchtargetmark();fulltree.deanchor();fulltree.move(40,widthres-40,40,heightres-40);draw2()
}function marksearch(){if((!flying)&&(document.getElementById("searchtf").value!="")){performsearch2(false);highlight_search=(document.forms.myform["domarksearch"].checked);if(fulltree.searchin==1){document.getElementById("numhittxt").innerHTML=("1 hit")}else{if(fulltree.searchin<=0){document.getElementById("numhittxt").innerHTML=("no hits")}else{document.getElementById("numhittxt").innerHTML=((fulltree.searchin).toString()+" hits")}}document.getElementById("numhittxt").style.display="";if((document.forms.myform["flightsearch"].checked)){performfly()}else{performleap()}draw2()}}function skip_intro(){clearTimeout(t);clearbuttons();buttonoptions=0;reopenbuttons();highlight_search=true;fulltree.search_URLinit();if(genus2_URL||taxa2_URL){fulltree.search_URLinit2()}fulltree.targeted=true;fulltree.deanchor();fulltree.move(40,widthres-40,40,heightres-40);draw2();search_init_end();Resize();introlock=false}function stop_intro(){clearTimeout(t);clearbuttons();buttonoptions=0;reopenbuttons();search_init_end();Resize();introlock=false}function replay_intro(){if((animation_status!=0)&&(animation_status!=-1)){popup_out();clearTimeout(t);animation_status=1;init()}}function search_init(){highlight_search=true;fulltree.search_URLinit();if(genus2_URL||taxa2_URL){fulltree.search_URLinit2()}if(fulltree.searchin>0){if(init_URL==1){Resize();if(viewtype==2){performflyC()}else{performflyB()}}else{if(init_URL!=5){fulltree.deanchor();fulltree.move(40,widthres-40,40,heightres-40);if(init_URL==3){search_init_end()}else{if(init_URL==2){introlock=true;click2zoomnum=Math.min(length_init_zoom2,Math.round(Math.log(0.6*ws/wsinit/fulltree.mult())/Math.log(init_zoom_speed)));var a=Math.pow(init_zoom_speed,click2zoomnum+1);ws=ws/a;xp=widthres/2+(xp-widthres/2)/a;yp=heightres/2+(yp-heightres/2)/a;init_zoom()}else{if(init_URL==4){justopened=true;animation_status=2;draw2();buttonoptions=2;document.getElementById("closebutton").style.display="";document.getElementById("growtitle").style.display="";document.getElementById("growtxt").style.display="";document.getElementById("revgbutton").style.display="";document.getElementById("pausegbutton").style.display="";document.getElementById("playgbutton").style.display="";document.getElementById("endgbutton").style.display="";growplay();Resize();setTimeout("cancelfirstuse()",10000)}}}}else{search_init_end();draw2()}}}}function init_zoom(){clearTimeout(t);ws=ws*init_zoom_speed;xp=widthres/2+(xp-widthres/2)*init_zoom_speed;yp=heightres/2+(yp-heightres/2)*init_zoom_speed;draw2();click2zoomnum--;if(click2zoomnum>=0){t=setTimeout("init_zoom()",33)}else{introlock=false;search_init_end()}}function marksearchchange(){highlight_search=(document.forms.myform["domarksearch"].checked);draw2()}function unmarksearch(){if(highlight_search){highlight_search=false}else{highlight_search=true}draw2()}function performclear(){highlight_search=false;searchinparts=[];context.clearRect(0,0,widthres,heightres);draw2()}midnode.prototype.setxyr=function(m,l,a,k,b,j,q,e,f){var d;var n;var p;var h;if(this.child1){if(e!=2){d=m+a*this.nextx1+a*this.nextr1*this.child1.hxmax;n=m+a*this.nextx1+a*this.nextr1*this.child1.hxmin;p=l+a*this.nexty1+a*this.nextr1*this.child1.hymax;h=l+a*this.nexty1+a*this.nextr1*this.child1.hymin;if(e!=1){if(d<(m+a*this.nextx2+a*this.nextr2*this.child2.hxmax)){d=(m+a*this.nextx2+a*this.nextr2*this.child2.hxmax)}if(n>(m+a*this.nextx2+a*this.nextr2*this.child2.hxmin)){n=(m+a*this.nextx2+a*this.nextr2*this.child2.hxmin)}if(p<(l+a*this.nexty2+a*this.nextr2*this.child2.hymax)){p=(l+a*this.nexty2+a*this.nextr2*this.child2.hymax)}if(h>(l+a*this.nexty2+a*this.nextr2*this.child2.hymin)){h=(l+a*this.nexty2+a*this.nextr2*this.child2.hymin)}}}else{d=m+a*this.nextx2+a*this.nextr2*this.child2.hxmax;n=m+a*this.nextx2+a*this.nextr2*this.child2.hxmin;p=l+a*this.nexty2+a*this.nextr2*this.child2.hymax;h=l+a*this.nexty2+a*this.nextr2*this.child2.hymin}}else{d=(m+a*(this.arcx+this.arcr));n=(m+a*(this.arcx-this.arcr));p=(l+a*(this.arcy+this.arcr));h=(l+a*(this.arcy-this.arcr))}if(d<(m+a*(this.bezsx+this.bezex)/2)){d=(m+a*(this.bezsx+this.bezex)/2)}if(n>(m+a*(this.bezsx+this.bezex)/2)){n=(m+a*(this.bezsx+this.bezex)/2)}if(p<(l+a*(this.bezsy+this.bezey)/2)){p=(l+a*(this.bezsy+this.bezey)/2)}if(h>(l+a*(this.bezsy+this.bezey)/2)){h=(l+a*(this.bezsy+this.bezey)/2)}var g=((q-j)/(p-h));var c=((b-k)/(d-n));var o;if(g>c){o=c}else{o=g}xp+=(((b+k)/2)-((d+n)/2));yp+=(((q+j)/2)-((p+h)/2));ws=ws*o;xp=widthres/2+(xp-widthres/2)*o;yp=heightres/2+(yp-heightres/2)*o};midnode.prototype.setxyr3r=function(h,b,g,o){ws=1;xp=widthres/2;yp=heightres;var k=xp;var j=yp;var a=220*ws;var d;var l;var n;var f;if(this.child1){d=k+a*this.nextx1+a*this.nextr1*this.child1.hxmax;l=k+a*this.nextx1+a*this.nextr1*this.child1.hxmin;n=j+a*this.nexty1+a*this.nextr1*this.child1.hymax;f=j+a*this.nexty1+a*this.nextr1*this.child1.hymin;if(d<(k+a*this.nextx2+a*this.nextr2*this.child2.hxmax)){d=(k+a*this.nextx2+a*this.nextr2*this.child2.hxmax)}if(l>(k+a*this.nextx2+a*this.nextr2*this.child2.hxmin)){l=(k+a*this.nextx2+a*this.nextr2*this.child2.hxmin)
}if(n<(j+a*this.nexty2+a*this.nextr2*this.child2.hymax)){n=(j+a*this.nexty2+a*this.nextr2*this.child2.hymax)}if(f>(j+a*this.nexty2+a*this.nextr2*this.child2.hymin)){f=(j+a*this.nexty2+a*this.nextr2*this.child2.hymin)}}else{d=(k+a*(this.arcx+this.arcr));l=(k+a*(this.arcx-this.arcr));n=(j+a*(this.arcy+this.arcr));f=(j+a*(this.arcy-this.arcr))}if(d<(k+a*(this.bezsx+this.bezex)/2)){d=(k+a*(this.bezsx+this.bezex)/2)}if(l>(k+a*(this.bezsx+this.bezex)/2)){l=(k+a*(this.bezsx+this.bezex)/2)}if(n<(j+a*(this.bezsy+this.bezey)/2)){n=(j+a*(this.bezsy+this.bezey)/2)}if(f>(j+a*(this.bezsy+this.bezey)/2)){f=(j+a*(this.bezsy+this.bezey)/2)}var e=((o-g)/(n-f));var c=((b-h)/(d-l));var m;if(e>c){m=c}else{m=e}xp+=(((b+h)/2)-((d+l)/2));yp+=(((o+g)/2)-((n+f)/2));ws=ws*m;xp=widthres/2+(xp-widthres/2)*m;yp=heightres/2+(yp-heightres/2)*m};midnode.prototype.setxyr2=function(h,g,m,c,d,o,q,p,v,k){var j;var f;var n;var l;if(p!=3){j=(h+m*(this.fxmax));f=(h+m*(this.fxmin));n=(g+m*(this.fymax));l=(g+m*(this.fymin))}else{if(this.child1){j=h+m*this.nextx1+m*this.nextr1*this.child1.hxmax;f=h+m*this.nextx1+m*this.nextr1*this.child1.hxmin;n=g+m*this.nexty1+m*this.nextr1*this.child1.hymax;l=g+m*this.nexty1+m*this.nextr1*this.child1.hymin;if(j<(h+m*this.nextx2+m*this.nextr2*this.child2.hxmax)){j=(h+m*this.nextx2+m*this.nextr2*this.child2.hxmax)}if(f>(h+m*this.nextx2+m*this.nextr2*this.child2.hxmin)){f=(h+m*this.nextx2+m*this.nextr2*this.child2.hxmin)}if(n<(g+m*this.nexty2+m*this.nextr2*this.child2.hymax)){n=(g+m*this.nexty2+m*this.nextr2*this.child2.hymax)}if(l>(g+m*this.nexty2+m*this.nextr2*this.child2.hymin)){l=(g+m*this.nexty2+m*this.nextr2*this.child2.hymin)}}else{j=(h+m*(this.arcx+this.arcr));f=(h+m*(this.arcx-this.arcr));n=(g+m*(this.arcy+this.arcr));l=(g+m*(this.arcy-this.arcr))}if(j<(h+m*(this.bezsx+this.bezex)/2)){j=(h+m*(this.bezsx+this.bezex)/2)}if(f>(h+m*(this.bezsx+this.bezex)/2)){f=(h+m*(this.bezsx+this.bezex)/2)}if(n<(g+m*(this.bezsy+this.bezey)/2)){n=(g+m*(this.bezsy+this.bezey)/2)}if(l>(g+m*(this.bezsy+this.bezey)/2)){l=(g+m*(this.bezsy+this.bezey)/2)}}var a=((q-o)/(n-l));var b=((d-c)/(j-f));var s;if(a>b){s=b}else{s=a}s=Math.pow(s,(1/v));var e;var u;if(Math.abs(s-1)<0.000001){e=(((d+c)/2)-((j+f)/2));u=(((q+o)/2)-((n+l)/2))}else{e=(((d+c)/2)-((j+f)/2))*((1-(1/s))/(1-(Math.pow((1/s),v))));u=(((q+o)/2)-((n+l)/2))*((1-(1/s))/(1-(Math.pow((1/s),v))))}xp+=e;yp+=u;ws=ws*s;xp=widthres/2+(xp-widthres/2)*s;yp=heightres/2+(yp-heightres/2)*s};midnode.prototype.move=function(d,b,c,a){if(this.targeted){this.graphref=true;if(this.child1){if(this.child1.targeted){this.child1.move(d,b,c,a)}else{if(this.child2.targeted){this.child2.move(d,b,c,a)}else{this.setxyr3r(40,widthres-40,40,heightres-40);this.setxyr3r(40,widthres-40,40,heightres-40)}}}else{this.setxyr3r(40,widthres-40,40,heightres-40);this.setxyr3r(40,widthres-40,40,heightres-40)}}};midnode.prototype.move3=function(d,b,c,a){if(this.onroute){if(this.child1){if(this.child1.onroute){this.child1.move3(d,b,c,a)}else{if(this.child2.onroute){this.child2.move3(d,b,c,a)}else{this.setxyr3r(40,widthres-40,40,heightres-40);this.setxyr3r(40,widthres-40,40,heightres-40)}}}else{this.setxyr3r(40,widthres-40,40,heightres-40);this.setxyr3r(40,widthres-40,40,heightres-40)}}};midnode.prototype.move2=function(){if(this.dvar){this.onroute=true;if((!(this.gvar))&&(this.child1)){if(!((this.child1.dvar)&&(this.child2.dvar))){if(this.child1.dvar){this.child1.move2()}else{if(this.child2.dvar){this.child2.move2()}}}}}};midnode.prototype.clearonroute=function(){this.onroute=false;if(this.child1){(this.child1).clearonroute();(this.child2).clearonroute()}};midnode.prototype.flyFB=function(e,c,d,b){var a=this.xvar;var g=this.yvar;var f=this.rvar;if(this.targeted){if(this.flysofarB){if(this.child1){if(this.child1.targeted){this.child1.flyFB(e,c,d,b)}else{if(this.child2.targeted){this.child2.flyFB(e,c,d,b)}else{if(this.flysofarB){if(flying){clearTimeout(t);fulltree.searchtargetmark();flying=false}}else{this.setxyr2(a,g,f,e,c,d,b,3,countdownB,2);if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}}}}else{if(this.flysofarB){if(flying){clearTimeout(t);fulltree.searchtargetmark();flying=false}}else{this.setxyr2(a,g,f,e,c,d,b,3,countdownB,2);if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}}}else{if(this.child1){if(this.child1.targeted){this.setxyr2(a,g,f,e,c,d,b,1,countdownB,2);if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}else{if(this.child2.targeted){this.setxyr2(a,g,f,e,c,d,b,2,countdownB,2);if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}else{if(this.flysofarB){if(flying){clearTimeout(t);fulltree.searchtargetmark();flying=false}}else{this.setxyr2(a,g,f,e,c,d,b,3,countdownB,2);if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}}}}else{if(this.flysofarB){if(flying){clearTimeout(t);fulltree.searchtargetmark();flying=false}}else{this.setxyr2(a,g,f,e,c,d,b,3,countdownB,2);
if(countdownB<=1){this.flysofarB=true;countdownB=length_intro_in2}else{countdownB--}}}}}};midnode.prototype.prepfly=function(a,c,b){if(this.targeted){this.fxmax=this.gxmax;this.fxmin=this.gxmin;this.fymax=this.gymax;this.fymin=this.gymin;if(this.child1){if(this.child1.targeted){this.child1.prepfly(a+b*this.nextx1,c+b*this.nexty1,b*this.nextr1);if(this.fxmax<(this.nextx1+this.nextr1*this.child1.fxmax)){this.fxmax=(this.nextx1+this.nextr1*this.child1.fxmax)}if(this.fxmin>(this.nextx1+this.nextr1*this.child1.fxmin)){this.fxmin=(this.nextx1+this.nextr1*this.child1.fxmin)}if(this.fymax<(this.nexty1+this.nextr1*this.child1.fymax)){this.fymax=(this.nexty1+this.nextr1*this.child1.fymax)}if(this.fymin>(this.nexty1+this.nextr1*this.child1.fymin)){this.fymin=(this.nexty1+this.nextr1*this.child1.fymin)}}else{if(this.child2.targeted){this.child2.prepfly(a+b*this.nextx2,c+b*this.nexty2,b*this.nextr2);if(this.fxmax<(this.nextx2+this.nextr2*this.child2.fxmax)){this.fxmax=(this.nextx2+this.nextr2*this.child2.fxmax)}if(this.fxmin>(this.nextx2+this.nextr2*this.child2.fxmin)){this.fxmin=(this.nextx2+this.nextr2*this.child2.fxmin)}if(this.fymax<(this.nexty2+this.nextr2*this.child2.fymax)){this.fymax=(this.nexty2+this.nextr2*this.child2.fymax)}if(this.fymin>(this.nexty2+this.nextr2*this.child2.fymin)){this.fymin=(this.nexty2+this.nextr2*this.child2.fymin)}}else{this.fxmax=this.hxmax;this.fxmin=this.hxmin;this.fymax=this.hymax;this.fymin=this.hymin}}}else{this.fxmax=this.hxmax;this.fxmin=this.hxmin;this.fymax=this.hymax;this.fymin=this.hymin}}};function performfly(){if(!flying){if(viewtype==2){fulltree.deanchor();fulltree.graphref=true;fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);wsinit=ws;draw2();fulltree.semiclearsearch();flying=true;performsearch2(false);if(fulltree.searchtarget()==-1){searchinparts=[];performsearch2(false);fulltree.searchtarget()}fulltree.targeted=true;countdownB=length_intro_in2*2;fulltree.flysofarB=true;if(fulltree.child1){if(fulltree.child1.targeted){if(((fulltree.child1).child1)&&((fulltree.child1).child1.targeted||(fulltree.child1).child2.targeted)){fulltree.child1.flysofarB=true}}if(fulltree.child2.targeted){if(((fulltree.child2).child1)&&((fulltree.child2).child1.targeted||(fulltree.child2).child2.targeted)){fulltree.child2.flysofarB=true}}}fulltree.prepfly(xp,yp,220*ws,5);performfly2()}else{fulltree.clear_xyr_var();fulltree.deanchor();fulltree.graphref=true;fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);wsinit=ws;draw2();fulltree.semiclearsearch();flying=true;performsearch2(false);if(fulltree.searchtarget()==-1){searchinparts=[];performsearch2(false);fulltree.searchtarget()}fulltree.targeted=true;fulltree.drawreg(xp,yp,220*ws);fulltree.get_xyr_target(xp,yp,220*ws);pre_xp=xp;pre_yp=yp;pre_ws=ws;intro_step_num=0;intro_sec_step_num=0;length_intro=Math.log(r_mult)*length_intro_in;num_intro_steps=length_intro;draw2();t=setTimeout("performflyB2()",100)}}}midnode.prototype.clear_xyr_var=function(){if(this.child1){this.child1.clear_xyr_var();this.child2.clear_xyr_var()}this.xvar=null;this.yvar=null;this.rvar=null};function performfly2(){fulltree.drawreg(xp,yp,220*ws);fulltree.flyFB(40,widthres-40,40,heightres-40);draw2();if(flying){t=setTimeout("performfly2()",100)}else{if(introlock){introlock=false;search_init_end();animation_status=2;draw2()}else{if(flying){fulltree.searchtargetmark();flying=false}}}}function performflyC(){introlock=true;flying=true;fulltree.deanchor();fulltree.graphref=true;fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);wsinit=ws;fulltree.drawreg(xp,yp,220*ws);fulltree.get_xyr_target(xp,yp,220*ws);countdownB=length_intro_in2*2;fulltree.flysofarB=true;if(fulltree.child1){if(fulltree.child1.targeted){if(((fulltree.child1).child1)&&((fulltree.child1).child1.targeted||(fulltree.child1).child2.targeted)){fulltree.child1.flysofarB=true}}if(fulltree.child2.targeted){if(((fulltree.child2).child1)&&((fulltree.child2).child1.targeted||(fulltree.child2).child2.targeted)){fulltree.child2.flysofarB=true}}}fulltree.prepfly(xp,yp,220*ws,5);performfly2()}var x_add;var y_add;var r_mult;var pre_xp;var pre_yp;var pre_ws;var length_intro;var num_intro_steps;var intro_step_num;var intro_sec_step_num;function performflyB(){introlock=true;fulltree.deanchor();fulltree.graphref=true;fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);fulltree.setxyr(xp,yp,220*ws,20,widthres-2,20,heightres,0,1);wsinit=ws;fulltree.drawreg(xp,yp,220*ws);fulltree.get_xyr_target(xp,yp,220*ws);pre_xp=xp;pre_yp=yp;pre_ws=ws;intro_step_num=0;intro_sec_step_num=0;length_intro=Math.log(r_mult)*length_intro_in;num_intro_steps=length_intro;draw2();t=setTimeout("performflyB2()",100)}function continue_flyB(){clearTimeout(t);intro_sec_step_num=0;num_intro_steps=length_intro-intro_step_num;fulltree.get_xyr_target(xp,yp,220*ws);
pre_xp=xp;pre_yp=yp;pre_ws=ws;t=setTimeout("performflyB2()",100)}function performflyB2(){if((intro_step_num<=length_intro)&&(introlock||flying)){auto_pan_zoom(intro_sec_step_num/num_intro_steps,intro_sec_step_num/num_intro_steps);draw2();intro_step_num++;intro_sec_step_num++;clearTimeout(t);t=setTimeout("performflyB2()",100)}else{if(introlock){introlock=false;search_init_end();animation_status=2;draw2()}else{if(flying){fulltree.searchtargetmark();flying=false}}}}search_init_end=function(){animation_status=2;justopened=true;draw2();if($("#myCanvas").attr("data_status")!="embedded"&&$("#myCanvas").attr("data_status")!="embedded_front"){document.getElementById("closebutton").style.display=""}setTimeout("cancelfirstuse()",5000)};midnode.prototype.get_xyr_target=function(c,n,f){var g=Math.max(40*2/heightres,40*2/widthres);var o,m,a;if(this.rvar){o=this.xvar;m=this.yvar;a=this.rvar}else{o=c;m=n;a=f}var h=false;if(this.targeted){if(this.child1){if(this.child1.targeted){this.child1.get_xyr_target(o+a*this.nextx1,m+a*this.nexty1,a*this.nextr1)}else{if(this.child2.targeted){this.child2.get_xyr_target(o+a*this.nextx2,m+a*this.nexty2,a*this.nextr2)}else{h=true}}}else{h=true}}if(h){var e;var p;var q;var k;if(this.child1){e=o+a*this.nextx1+a*this.nextr1*this.child1.hxmax;p=o+a*this.nextx1+a*this.nextr1*this.child1.hxmin;q=m+a*this.nexty1+a*this.nextr1*this.child1.hymax;k=m+a*this.nexty1+a*this.nextr1*this.child1.hymin;if(e<(o+a*this.nextx2+a*this.nextr2*this.child2.hxmax)){e=(o+a*this.nextx2+a*this.nextr2*this.child2.hxmax)}if(p>(o+a*this.nextx2+a*this.nextr2*this.child2.hxmin)){p=(o+a*this.nextx2+a*this.nextr2*this.child2.hxmin)}if(q<(m+a*this.nexty2+a*this.nextr2*this.child2.hymax)){q=(m+a*this.nexty2+a*this.nextr2*this.child2.hymax)}if(k>(m+a*this.nexty2+a*this.nextr2*this.child2.hymin)){k=(m+a*this.nexty2+a*this.nextr2*this.child2.hymin)}}else{e=(o+a*(this.arcx+this.arcr));p=(o+a*(this.arcx-this.arcr));q=(m+a*(this.arcy+this.arcr));k=(m+a*(this.arcy-this.arcr))}if(e<(o+a*(this.bezsx+this.bezex)/2)){e=(o+a*(this.bezsx+this.bezex)/2)}if(p>(o+a*(this.bezsx+this.bezex)/2)){p=(o+a*(this.bezsx+this.bezex)/2)}if(q<(m+a*(this.bezsy+this.bezey)/2)){q=(m+a*(this.bezsy+this.bezey)/2)}if(k>(m+a*(this.bezsy+this.bezey)/2)){k=(m+a*(this.bezsy+this.bezey)/2)}var b=e;var l=p;var j=q;var d=k;if((widthres/heightres)>((b-l)/(j-d))){r_mult=heightres/(j-d)/(1+2*g)}else{r_mult=widthres/(b-l)/(1+2*g)}x_add=(b+l-widthres)/2;y_add=(j+d-heightres)/2}};auto_pan_zoom=function(a,b){var c=y_add+heightres/2;var d=x_add+widthres/2;ws=pre_ws*(Math.pow(r_mult,b));xp=d+(pre_xp-d)*(Math.pow(r_mult,b))-x_add*a;yp=c+(pre_yp-c)*(Math.pow(r_mult,b))-y_add*a};function popup_search(){if(!introlock){justopened=false;if(buttonoptions==1){popuptext="Close search bar"}else{popuptext="Open search bar"}draw2()}}function popup_grow(){if(!introlock){justopened=false;if(buttonoptions==2){popuptext="Close growth animation bar"}else{popuptext="Open growth animation bar"}draw2()}}function popup_view(){if(!introlock){justopened=false;if(buttonoptions==3){popuptext="Close view options bar"}else{popuptext="Open view options bar"}draw2()}}function popup_reset(){if(!introlock){var a;if($("#myCanvas").attr("data_status")=="embedded"&&(animation_status!=-1)&&(animation_status!=-3)){a="Replay animation"}else{a="Reset"}if($("#myCanvas").attr("data_status")=="embedded"&&(animation_status==0)){a=null}justopened=false;popuptext=a;draw2()}}function popup_fullscreen(){if(!introlock){justopened=false;popuptext="Open in full screen";draw2()}}function popup_tutorial(){if(!introlock){justopened=false;popuptext="Open tutorial window";draw2()}}function popup_more(){if(!introlock){justopened=false;if(buttonoptions==5){popuptext="Close more options bar"}else{popuptext="Open more options bar"}draw2()}}function popup_twitter(){if(!introlock){justopened=false;popuptext="Follow us on Twitter";draw2()}}function popup_shape(){if(!introlock){justopened=false;popuptext="Change fractal shape";draw2()}}function popup_facebook(){if(!introlock){justopened=false;popuptext="Like us on Facebook";draw2()}}function popup_OZsite(){if(!introlock){justopened=false;popuptext2="See more trees on OneZoom";draw2()}}function popup_Logo1(){if(!introlock){justopened=false;popuptext2=text_URL;draw2()}}function popup_AboutOZ(){if(!introlock){justopened=false;popuptext2="Read more about this page";draw2()}}function popup_Zoomin(){if(!introlock){justopened=false;if(zoominnum>0){popuptext="Click or scroll up to zoom in";draw2()}}}function popup_Zoomout(){if(!introlock){justopened=false;if(zoomoutnum>0){popuptext="Click or scroll down to zoom out";draw2()}}}function popup_home(){if(!introlock){justopened=false;popuptext="Goto OneZoom, see more trees";draw2()}}function popup_out(){if(!introlock){justopened=false;popuptext=null;popuptext2=null;draw2()}}function clearbuttons(){document.getElementById("growtxt").style.display="none";document.getElementById("viewtxt").style.display="none";document.getElementById("viewtxt2").style.display="none";
document.getElementById("searchtxt").style.display="none";document.getElementById("moretxt").style.display="none";document.getElementById("detailincbutton").style.display="none";document.getElementById("detaildecbutton").style.display="none";document.getElementById("info button").style.display="none";document.getElementById("formbutton").style.display="none";document.getElementById("colourbutton").style.display="none";document.getElementById("spbutton").style.display="none";document.getElementById("namebutton").style.display="none";document.getElementById("polybutton").style.display="none";document.getElementById("growtitle").style.display="none";document.getElementById("revgbutton").style.display="none";document.getElementById("pausegbutton").style.display="none";document.getElementById("playgbutton").style.display="none";document.getElementById("startgbutton").style.display="none";document.getElementById("endgbutton").style.display="none";document.getElementById("searchtf").style.display="none";document.getElementById("searchbutton").style.display="none";document.getElementById("searchbutton2").style.display="none";document.getElementById("leapbutton").style.display="none";document.getElementById("flybutton").style.display="none";document.getElementById("latincheckbox").style.display="none";document.getElementById("latintxt").style.display="none";document.getElementById("commoncheckbox").style.display="none";document.getElementById("commontxt").style.display="none";document.getElementById("traitcheckbox").style.display="none";document.getElementById("traittxt").style.display="none";document.getElementById("flightcheckbox").style.display="none";document.getElementById("flighttxt").style.display="none";document.getElementById("markingscheckbox").style.display="none";document.getElementById("markingstxt").style.display="none";document.getElementById("numhittxt").style.display="none";document.getElementById("searchclearbutton").style.display="none";document.getElementById("skip_into_button").style.display="none";document.getElementById("replay_into_button").style.display="none";document.getElementById("stop_into_button").style.display="none";document.getElementById("datatxt").style.display="none";document.getElementById("datatxtin").style.display="none";document.getElementById("databutton").style.display="none";document.getElementById("closebutton").style.display="none"}function reopenbuttons(){if(((growing)||(growingpause))&&(buttonoptions==0)){document.getElementById("endgbutton").style.display=""}else{if((buttonoptions==0)&&(infotype!=0)){document.getElementById("closebutton").style.display=""}}}function Closebar(){if(!introlock){if((buttonoptions==0)&&(infotype!=0)){infotype=0;document.getElementById("viewtxt2").style.display="none";widthofcontrols-=100}clearbuttons();buttonoptions=0;reopenbuttons();Resize()}}function init_bar(){buttonoptions=7;document.getElementById("skip_into_button").style.display="";document.getElementById("stop_into_button").style.display="";document.getElementById("replay_into_button").style.display=""}function searchoptions(){if(!introlock){justopened=false;clearbuttons();if(buttonoptions==1){buttonoptions=0;popuptext="Open search bar";reopenbuttons()}else{buttonoptions=1;document.getElementById("closebutton").style.display="";document.getElementById("searchtxt").style.display="";document.getElementById("searchtf").style.display="";document.getElementById("searchbutton").style.display="";document.getElementById("flightcheckbox").style.display="";document.getElementById("flighttxt").style.display="";document.getElementById("numhittxt").style.display="";document.getElementById("latincheckbox").style.display="";document.getElementById("latintxt").style.display="";document.getElementById("searchclearbutton").style.display="";document.getElementById("commoncheckbox").style.display="";document.getElementById("commontxt").style.display="";popuptext="Close search bar"}Resize()}}function growoptions(){if(!introlock){justopened=false;clearbuttons();if(buttonoptions==2){buttonoptions=0;popuptext="Open growth animation bar";reopenbuttons()}else{buttonoptions=2;document.getElementById("closebutton").style.display="";document.getElementById("growtitle").style.display="";document.getElementById("growtxt").style.display="";document.getElementById("revgbutton").style.display="";document.getElementById("pausegbutton").style.display="";document.getElementById("playgbutton").style.display="";document.getElementById("endgbutton").style.display="";if((!growingpause)&&(!growing)){growplay()}popuptext="Close growth animation bar"}Resize()}}function viewoptions(){if(!introlock){justopened=false;clearbuttons();if(buttonoptions==3){buttonoptions=0;popuptext="Open view options bar";reopenbuttons()}else{buttonoptions=3;document.getElementById("viewtxt").style.display="";document.getElementById("closebutton").style.display="";document.getElementById("formbutton").style.display="";document.getElementById("colourbutton").style.display="";
document.getElementById("spbutton").style.display="";document.getElementById("namebutton").style.display="";popuptext="Close view options bar"}Resize()}}function moreoptions(){if(!introlock){justopened=false;clearbuttons();if(buttonoptions==5){buttonoptions=0;popuptext="Open more options bar";reopenbuttons()}else{buttonoptions=5;document.getElementById("moretxt").style.display="";document.getElementById("closebutton").style.display="";document.getElementById("info button").style.display="";document.getElementById("detailincbutton").style.display="";document.getElementById("detaildecbutton").style.display="";document.getElementById("polybutton").style.display="";if(infotype!=0){document.getElementById("viewtxt2").style.display=""}popuptext="Close more options bar"}Resize()}}function dataoptions(){if(!introlock){justopened=false;clearbuttons();if(buttonoptions==4){buttonoptions=0;reopenbuttons()}else{document.getElementById("closebutton").style.display="";document.getElementById("datatxt").style.display="";document.getElementById("datatxtin").style.display="";document.getElementById("databutton").style.display="";buttonoptions=4}Resize()}}function toggledisplay(){if(infotype==0){widthofcontrols+=100;infotype=3;document.getElementById("viewtxt2").style.display=""}else{if(infotype==3){infotype=4;document.getElementById("viewtxt2").style.display=""}else{infotype=0;document.getElementById("viewtxt2").style.display="none";widthofcontrols-=100}}Resize()}function detailup(){if(threshold>0.6){threshold=threshold/2}draw2()}function detaildown(){if(threshold<3.9){threshold=threshold*2}draw2()}function form_change(){if(!introlock){shapechanged=true;clearTimeout(t);flying=false;if(viewtype==1){viewtype=2}else{if(viewtype==2){viewtype=3}else{if(viewtype==3){viewtype=4}else{viewtype=1}}}draw_loading();setTimeout("form_change2()",1)}}function form_change2(){if(!introlock){update_form();Resize();Reset();if((genus_URL||taxa_URL)){highlight_search=true;fulltree.search_URLinit();if(genus2_URL||taxa2_URL){fulltree.search_URLinit2()}draw2()}}}function polyt_change(){if(polytype==total_num_polyt){polytype=1}else{polytype++}draw2()}function colour_change(){if(colourtype==total_num_cols){colourtype=1}else{colourtype++}draw2()}function name_change(){if(commonlabels==true){commonlabels=false}else{commonlabels=true}draw2()}function signpost_change(){if(drawsignposts==true){drawsignposts=false;thresholdtxt=1.5}else{drawsignposts=true;thresholdtxt=2}draw2()}function Link2OZ(){if(!introlock){justopened=false;window.location.href="http://www.onezoom.org/index.htm"}}function Link2Facebook(){if(!introlock){justopened=false;mywindow=window.open("http://www.facebook.com/OneZoomTree")}}function Link2Twitter(){if(!introlock){justopened=false;mywindow=window.open("https://twitter.com/OneZoomTree")}}function Link2Logo1(){if(!introlock){justopened=false;if(url_URL.indexOf("http")==0){window.location.href=url_URL}else{window.location.href="https://"+url_URL}}}function tutorialstart(){if(!introlock){justopened=false;mywindow=window.open("https://www.youtube.com/watch?v=ngt0XLFgN28");popup_out()}}function button_zoomin(){if(typeof use_image_before_loading!="undefined"){use_image_before_loading=false}if(animation_status==-1){animation_status=-3}else{if(animation_status==2){animation_status=-2}else{if(animation_status==0){animation_status=1}else{if(animation_status==1){return}}}}if(draft_only==true){draft_only=false;init();return}CZoomin()}function button_zoomout(){if(typeof use_image_before_loading!="undefined"){use_image_before_loading=false}if(animation_status==-1){animation_status=-3}else{if(animation_status==2){animation_status=-2}else{if(animation_status==0){animation_status=1}else{if(animation_status==1){return}}}}if(draft_only==true){draft_only=false;init();return}CZoomout()}function open_another_window(){var a;if(window.location.search.length>1){a=window.location.search}else{a=window.location.hash}window.open(file_name+".htm"+a)};
